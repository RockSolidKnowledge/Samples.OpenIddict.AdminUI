"use strict";(self.webpackChunkidentity_express_manager_ui=self.webpackChunkidentity_express_manager_ui||[]).push([[866],{866:(ti,U,l)=>{l.r(U),l.d(U,{EditUsersModule:()=>Kt});var d=l(177),h=l(1583),A=l(7005),p=l(1780),c=l(9417),M=l(779),Z=l(534),G=l(5358),K=l(4446),q=l(6923),ee=l(3218),E=l(8416),te=l(621),N=l(140),Y=l(6354),T=l(1594),b=l(9838),f=l(9957),e=l(4438),g=l(5602),V=l(526),X=l(5424),C=l(345),v=l(5794),x=l(7499),B=l(6807),R=l(7156),ie=l(7294),y=l(8698),L=l(9550),se=l(3860),ne=l(7811),F=l(6536),P=l(6728),J=l(1589);const ae=["editClaimsForm"],le=["addClaimModal"],oe=["deleteClaimModal"],O=()=>({animated:!1,backdrop:"static"}),re=s=>({"disabled inactive":s});function ce(s,o){if(1&s&&(e.j41(0,"option",39)(1,"span"),e.EFF(2),e.k0s()()),2&s){let t;const n=e.XpG(),i=n.$implicit;e.Y8G("value",n.index),e.R7$(2),e.SpI(" ",null!==(t=i.displayName)&&void 0!==t?t:i.name," ")}}function me(s,o){if(1&s&&(e.qex(0),e.DNE(1,ce,3,2,"option",38),e.bVm()),2&s){const t=o.$implicit;e.R7$(),e.Y8G("ngIf",!t.required&&"role"!=t.name&&"sub"!=t.name)}}function pe(s,o){if(1&s&&e.nrm(0,"input",46),2&s){const t=e.XpG(2);e.Y8G("appClaimRegex",t.selectedClaim.rule)}}function de(s,o){1&s&&e.nrm(0,"input",47)}function ue(s,o){1&s&&(e.j41(0,"app-form-toggle",48),e.nrm(1,"input",49),e.k0s()),2&s&&e.Y8G("id","claimsFormInput")("isTraffic",!0)("isAlt",!1)}function fe(s,o){1&s&&(e.qex(0),e.nrm(1,"app-date-time",52),e.bVm())}function _e(s,o){1&s&&(e.qex(0),e.nrm(1,"app-date-time",53),e.bVm()),2&s&&(e.R7$(),e.Y8G("displayType","date"))}function he(s,o){if(1&s&&(e.j41(0,"div",50),e.DNE(1,fe,2,0,"ng-container",51)(2,_e,2,1,"ng-container",51),e.k0s()),2&s){const t=e.XpG(2);e.R7$(),e.Y8G("ngIf","birthdate"!=t.selectedClaim.name),e.R7$(),e.Y8G("ngIf","birthdate"==t.selectedClaim.name)}}function ge(s,o){if(1&s){const t=e.RV6();e.j41(0,"div",54)(1,"app-enum-claim-type-input",55),e.bIt("valueChanged",function(i){e.eBV(t);const a=e.XpG(2);return e.Njj(a.claimsForm.controls.value.setValue(i))}),e.k0s()()}if(2&s){const t=e.XpG(2);e.Y8G("id","value-for-"+t.selectedClaim.id),e.R7$(),e.Y8G("id","claimsFormInput")("typeId",t.selectedClaim.id)("hostingModal","addClaimModal")("value",t.claimsForm.value.value)}}function ve(s,o){if(1&s&&(e.j41(0,"p",56),e.EFF(1),e.k0s()),2&s){let t;const n=e.XpG(2);e.R7$(),e.SpI(" ",null!==(t=n.selectedClaim.ruleValidationFailureDescription)&&void 0!==t?t:""," ")}}function be(s,o){if(1&s&&(e.j41(0,"app-form-row",16),e.DNE(1,pe,1,1,"input",40)(2,de,1,0,"input",41)(3,ue,2,3,"app-form-toggle",42)(4,he,3,2,"div",43)(5,ge,2,5,"div",44)(6,ve,2,1,"p",45),e.k0s()),2&s){const t=e.XpG();e.Y8G("id","claimsFormInput")("label","Common.Value")("isLast",!0),e.R7$(),e.Y8G("ngIf","String"==t.selectedClaim.valueType),e.R7$(),e.Y8G("ngIf","Int"==t.selectedClaim.valueType),e.R7$(),e.Y8G("ngIf","Boolean"==t.selectedClaim.valueType),e.R7$(),e.Y8G("ngIf","DateTime"==t.selectedClaim.valueType),e.R7$(),e.Y8G("ngIf","Enum"==t.selectedClaim.valueType),e.R7$(),e.Y8G("ngIf",t.claimsForm.invalid&&t.claimsForm.dirty)}}function Ce(s,o){1&s&&(e.j41(0,"div",57)(1,"div"),e.EFF(2),e.nI1(3,"translate"),e.k0s()()),2&s&&(e.R7$(2),e.SpI(" ",e.bMT(3,1,"UserDetails.NoClaimsMessage")," "))}function Te(s,o){if(1&s&&(e.j41(0,"b"),e.EFF(1),e.k0s()),2&s){const t=e.XpG().$implicit;e.R7$(),e.JRh(t.displayName)}}function Re(s,o){if(1&s&&(e.j41(0,"b"),e.EFF(1),e.k0s()),2&s){const t=e.XpG().$implicit;e.R7$(),e.JRh(t.type)}}function ye(s,o){if(1&s&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&s){const t=e.XpG(2).$implicit;e.R7$(),e.SpI(" ",t.value," ")}}function Fe(s,o){if(1&s&&(e.j41(0,"span"),e.EFF(1),e.nI1(2,"standardDate"),e.k0s()),2&s){const t=e.XpG(3).$implicit;e.R7$(),e.SpI(" ",e.bMT(2,1,t.value),"")}}function Ie(s,o){if(1&s&&(e.j41(0,"span"),e.EFF(1),e.nI1(2,"standardDateTime"),e.k0s()),2&s){const t=e.XpG(3).$implicit;e.R7$(),e.SpI(" ",e.bMT(2,1,t.value),"")}}function ke(s,o){if(1&s&&(e.j41(0,"span"),e.DNE(1,Fe,3,3,"span",51)(2,Ie,3,3,"span",51),e.k0s()),2&s){const t=e.XpG(2).$implicit;e.R7$(),e.Y8G("ngIf","birthdate"==t.type),e.R7$(),e.Y8G("ngIf","birthdate"!=t.type)}}function je(s,o){1&s&&(e.j41(0,"div"),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&s&&(e.R7$(),e.JRh(e.bMT(2,1,"Common.True")))}function De(s,o){1&s&&(e.j41(0,"div"),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&s&&(e.R7$(),e.JRh(e.bMT(2,1,"Common.False")))}function Se(s,o){if(1&s&&(e.j41(0,"span"),e.DNE(1,je,3,3,"div",51)(2,De,3,3,"div",51),e.k0s()),2&s){const t=e.XpG(2).$implicit;e.R7$(),e.Y8G("ngIf","true"==t.value),e.R7$(),e.Y8G("ngIf","false"==t.value)}}function $e(s,o){1&s&&(e.j41(0,"span",67),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&s&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"Common.Policy")," "))}function we(s,o){if(1&s){const t=e.RV6();e.j41(0,"div",24)(1,"button",68),e.bIt("click",function(){e.eBV(t);const i=e.XpG(2).$implicit,a=e.XpG(2);return e.Njj(a.editClaim(i))}),e.nrm(2,"span",69),e.j41(3,"span",14),e.EFF(4),e.nI1(5,"translate"),e.k0s()(),e.j41(6,"button",70),e.bIt("click",function(){e.eBV(t);const i=e.XpG(2).$implicit,a=e.XpG(2);return e.Njj(a.delete(i))}),e.nrm(7,"span",13),e.j41(8,"span",14),e.EFF(9),e.nI1(10,"translate"),e.k0s()()()}2&s&&(e.R7$(4),e.JRh(e.bMT(5,2,"Common.Edit")),e.R7$(5),e.JRh(e.bMT(10,4,"Common.Delete.Title")))}function Ue(s,o){if(1&s&&(e.qex(0),e.j41(1,"td")(2,"div",64),e.DNE(3,ye,2,1,"span",51)(4,ke,3,2,"span",51)(5,Se,3,2,"span",51),e.k0s()(),e.j41(6,"td"),e.DNE(7,$e,3,3,"span",65),e.k0s(),e.j41(8,"td"),e.DNE(9,we,11,6,"div",66),e.k0s(),e.bVm()),2&s){const t=e.XpG().$implicit,n=e.XpG(2);e.R7$(3),e.Y8G("ngIf","DateTime"!=t.format&&"Boolean"!=t.format),e.R7$(),e.Y8G("ngIf","DateTime"==t.format),e.R7$(),e.Y8G("ngIf","Boolean"==t.format),e.R7$(2),e.Y8G("ngIf",n.isPolicyClaim(t)),e.R7$(2),e.Y8G("ngIf",!n.notAllowedToEditClaim(t))}}function Ae(s,o){if(1&s){const t=e.RV6();e.j41(0,"input",77),e.mxI("ngModelChange",function(i){e.eBV(t);const a=e.XpG(2).$implicit;return e.DH7(a.value,i)||(a.value=i),e.Njj(i)}),e.k0s()}if(2&s){const t=e.XpG(2).$implicit;e.R50("ngModel",t.value),e.Y8G("appClaimRegex",t.regex)}}function Me(s,o){if(1&s){const t=e.RV6();e.j41(0,"input",78),e.mxI("ngModelChange",function(i){e.eBV(t);const a=e.XpG(2).$implicit;return e.DH7(a.value,i)||(a.value=i),e.Njj(i)}),e.k0s()}if(2&s){const t=e.XpG(2).$implicit;e.R50("ngModel",t.value)}}function Ge(s,o){if(1&s){const t=e.RV6();e.qex(0),e.j41(1,"app-date-time",80),e.mxI("ngModelChange",function(i){e.eBV(t);const a=e.XpG(3).$implicit;return e.DH7(a.value,i)||(a.value=i),e.Njj(i)}),e.k0s(),e.bVm()}if(2&s){const t=e.XpG(3).$implicit;e.R7$(),e.R50("ngModel",t.value)}}function Ee(s,o){if(1&s){const t=e.RV6();e.qex(0),e.j41(1,"app-date-time",81),e.mxI("ngModelChange",function(i){e.eBV(t);const a=e.XpG(3).$implicit;return e.DH7(a.value,i)||(a.value=i),e.Njj(i)}),e.k0s(),e.bVm()}if(2&s){const t=e.XpG(3).$implicit;e.R7$(),e.R50("ngModel",t.value),e.Y8G("displayType","date")}}function Ne(s,o){if(1&s&&(e.j41(0,"div"),e.DNE(1,Ge,2,1,"ng-container",51)(2,Ee,2,2,"ng-container",51),e.j41(3,"span",79),e.EFF(4),e.nI1(5,"translate"),e.k0s()()),2&s){const t=e.XpG(2).$implicit;e.R7$(),e.Y8G("ngIf","birthdate"!=t.type),e.R7$(),e.Y8G("ngIf","birthdate"==t.type),e.R7$(2),e.SpI(" ",e.bMT(5,3,"Common.Dates.UTCWarning")," ")}}function Ye(s,o){if(1&s){const t=e.RV6();e.j41(0,"app-form-toggle",48)(1,"input",82),e.bIt("ngModelChange",function(i){e.eBV(t);const a=e.XpG(2).$implicit;return e.Njj(a.value=i?"true":"false")}),e.k0s()()}if(2&s){const t=e.XpG(2).$implicit;e.Y8G("id","claim-"+t.type)("isTraffic",!0)("isAlt",!1),e.R7$(),e.Y8G("id","claim-"+t.type)("ngModel","true"==t.value)}}function Ve(s,o){if(1&s){const t=e.RV6();e.j41(0,"span")(1,"app-enum-claim-type-input",83),e.bIt("valueChanged",function(i){e.eBV(t);const a=e.XpG(2).$implicit;return e.Njj(a.value=i)}),e.k0s()()}if(2&s){const t=e.XpG(2).$implicit;e.R7$(),e.Y8G("id","claimsFormInput")("typeId",t.typeId)("value",t.value)}}function Xe(s,o){if(1&s&&(e.j41(0,"span",56),e.EFF(1),e.k0s()),2&s){let t;const n=e.XpG(2).$implicit;e.R7$(),e.SpI(" ",null!==(t=null==n?null:n.failureMessage)&&void 0!==t?t:""," ")}}function xe(s,o){1&s&&(e.j41(0,"span",67),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&s&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"Common.Policy")," "))}function Be(s,o){if(1&s){const t=e.RV6();e.qex(0),e.j41(1,"td")(2,"form",null,2),e.DNE(4,Ae,1,2,"input",71)(5,Me,1,1,"input",72)(6,Ne,6,5,"div",51)(7,Ye,2,5,"app-form-toggle",42)(8,Ve,2,3,"span",51)(9,Xe,2,1,"span",45),e.k0s()(),e.j41(10,"td"),e.DNE(11,xe,3,3,"span",65),e.k0s(),e.j41(12,"td")(13,"div",73)(14,"button",74),e.bIt("click",function(){e.eBV(t);const i=e.XpG().$implicit,a=e.XpG(2);return e.Njj(a.updateClaim(i))}),e.nrm(15,"span",75),e.j41(16,"span",14),e.EFF(17),e.nI1(18,"translate"),e.k0s()(),e.j41(19,"button",76),e.bIt("click",function(){e.eBV(t);const i=e.XpG().$implicit,a=e.XpG(2);return e.Njj(a.cancelEdit(i))}),e.nrm(20,"span",13),e.j41(21,"span",14),e.EFF(22),e.nI1(23,"translate"),e.k0s()()()(),e.bVm()}if(2&s){let t,n;const i=e.sdS(3),a=e.XpG(),r=a.$implicit,m=a.index,u=e.XpG(2);e.R7$(4),e.Y8G("ngIf","String"==r.format),e.R7$(),e.Y8G("ngIf","Int"==r.format),e.R7$(),e.Y8G("ngIf","DateTime"==r.format),e.R7$(),e.Y8G("ngIf","Boolean"==r.format),e.R7$(),e.Y8G("ngIf","Enum"==r.format),e.R7$(),e.Y8G("ngIf",null!==(t=null==(t=i.form.get("claimValue"))?null:t.invalid)&&void 0!==t&&t),e.R7$(2),e.Y8G("ngIf",u.isPolicyClaim(r)),e.R7$(3),e.Y8G("disabled",u.notAllowedToEditClaim(r)||u.checkDisabled("Claim"+m)||null!==(n=null==(n=i.form.get("claimValue"))?null:n.invalid)&&void 0!==n&&n),e.R7$(3),e.JRh(e.bMT(18,10,"Common.Save")),e.R7$(5),e.JRh(e.bMT(23,12,"Common.Cancel"))}}function Le(s,o){if(1&s&&(e.j41(0,"tr",63)(1,"td"),e.DNE(2,Te,2,1,"b",51)(3,Re,2,1,"b",51),e.k0s(),e.DNE(4,Ue,10,5,"ng-container",51)(5,Be,24,14,"ng-container",51),e.k0s()),2&s){const t=o.$implicit,n=e.XpG(2);e.Y8G("ngClass",e.eq3(5,re,n.notAllowedToEditClaim(t))),e.R7$(2),e.Y8G("ngIf",t.displayName),e.R7$(),e.Y8G("ngIf",!t.displayName),e.R7$(),e.Y8G("ngIf",!t.editing),e.R7$(),e.Y8G("ngIf",t.editing)}}function Pe(s,o){if(1&s&&(e.j41(0,"table",58)(1,"thead")(2,"tr")(3,"th",59),e.EFF(4),e.nI1(5,"translate"),e.k0s(),e.j41(6,"th"),e.EFF(7),e.nI1(8,"translate"),e.k0s(),e.j41(9,"th",60)(10,"span",14),e.EFF(11),e.nI1(12,"translate"),e.k0s()(),e.j41(13,"th",60)(14,"span",14),e.EFF(15),e.nI1(16,"translate"),e.k0s()()()(),e.j41(17,"tbody",61),e.DNE(18,Le,6,7,"tr",62),e.k0s()()),2&s){const t=e.XpG();e.R7$(4),e.SpI(" ",e.bMT(5,5,"Common.Name")," "),e.R7$(3),e.SpI(" ",e.bMT(8,7,"Common.Value")," "),e.R7$(4),e.SpI("",e.bMT(12,9,"Common.Policy")," "),e.R7$(4),e.JRh(e.bMT(16,11,"Common.Actions")),e.R7$(3),e.Y8G("ngForOf",t.optionalClaims)}}function Je(s,o){if(1&s&&e.nrm(0,"app-pager",84),2&s){const t=e.XpG();e.Y8G("totalResults",null==t.optionalClaims?null:t.optionalClaims.length)}}let Oe=(()=>{class s{constructor(t,n,i,a,r,m,u,S,$,w){this.fb=t,this.userService=n,this.claimTypesService=i,this.translate=a,this.errorService=r,this.titleService=m,this.toastr=u,this.dialogService=S,this.apClaimsService=$,this.cdref=w,this.editing=!1,this.optionalClaims=[],this.requiredClaims=[],this.parser=new DOMParser}ngOnInit(){this.combinedObservable=this.claimTypesService.getClaimTypes(null,null,!0).pipe((0,N.v)(this.userService.getCachedUser()),(0,Y.T)(([t,n])=>({claimTypes:t,user:n})),(0,T.$)()).subscribe(t=>{this.claimTypes=t.claimTypes,this.user=t.user,this.claims=t.user.claims,this.sortClaims();const n=this.translate.instant("Users.Singular")+" "+this.user.username+" "+this.translate.instant("Nav.Additional Details")+" - "+b.$9.SITE_TITLE;this.titleService.setTitle(n)}),this.claimsForm=this.fb.group({type:[""],value:[""]},c.k0.required)}deleteClaim(t){this.userService.deleteUserClaim(this.user.subject,t).subscribe(n=>{this.closeDeleteModal();const i=this.optionalClaims.indexOf(t);this.optionalClaims.splice(i,1);const a=this.translate.instant("Notifications.Saving Success Title"),r=this.translate.instant("Notifications.Saving Success Message");this.toastr.success(a,r),this.user.claims=this.optionalClaims.concat(this.requiredClaims),this.userService.userSubject.next(this.user)},n=>{401===n.status?this.toastr.warning(this.translate.instant("UserDetails.UnauthorizedWarningDelete"),this.translate.instant("Notifications.Unauthorized")):this.errorService.handleError(n)})}delete(t){this.toDelete=t,this.deleteClaimModal.show()}closeDeleteModal(){this.toDelete=null,this.deleteClaimModal.hide()}closeAddModal(){this.claimsForm.controls.value.setValue(null),this.claimsForm.markAsPristine(),this.addClaimModal.hide()}canDeactivate(){return!this.editing||!this.editClaimsForm.dirty||(this.dialogService.confirm(),this.dialogService.eventStream)}cancelEdit(t){t.value=t.oldValue,t.editing=!1,this.editing=!1}changeFormat(t){var n=this.claimTypes[t];this.claimsForm.controls.value.setValue(null),this.claimsForm.markAsPristine(),"Boolean"===n?.valueType&&this.claimsForm.controls.value.setValue(!1),this.selectedClaim=n,this.cdref.detectChanges()}editClaim(t){t.oldValue=t.value,t.editing=!0,this.editing=!0}addClaim(){"sub"!==this.selectedClaim.name&&(("Int"===this.selectedClaim.valueType||"Boolean"===this.selectedClaim.valueType)&&(this.claimsForm.value.value=this.claimsForm.value.value.toString()),this.currentClaim=this.claimsForm.value,this.currentClaim.type=this.selectedClaim.name,this.currentClaim.typeId=this.selectedClaim.id,this.currentClaim.format=this.selectedClaim.valueType,this.currentClaim.displayName=this.selectedClaim.displayName,this.currentClaim.regex=this.selectedClaim.rule,this.currentClaim.failureMessage=this.selectedClaim.ruleValidationFailureDescription,this.submitClaim(this.currentClaim),this.closeAddModal())}checkDisabled(t){return!(!this.editClaimsForm||!this.editClaimsForm.controls[t])&&this.editClaimsForm.controls[t].invalid}updateClaim(t){"DateTime"===t.format&&(t.value=t.value),"Int"===t.format&&(t.value=t.value.toString()),this.userService.updateUserClaim(this.user.subject,{oldClaimType:t.type,oldClaimValue:t.oldValue,newClaimType:t.type,newClaimValue:t.value}).subscribe(i=>{t.editing=!1;const a=this.translate.instant("Notifications.Saving Success Title"),r=this.translate.instant("Notifications.Saving Success Message");this.toastr.success(a,r),this.user.claims=this.optionalClaims.concat(this.requiredClaims),this.userService.userSubject.next(this.user),this.editing=!1},i=>{if(401===i.status)this.toastr.warning(this.translate.instant("UserDetails.UnauthorizedWarningEdit"),this.translate.instant("Notifications.Unauthorized"));else{const a={toastBody:this.translate.instant("Notifications.Saving Error Title"),toastTitle:this.translate.instant("Notifications.Saving Error Message")};(this.errorService.handleError(i,a)&f.I.Toast)!==f.I.Toast&&this.toastr.error(a.toastBody,a.toastTitle)}})}submitClaim(t){this.userService.addUserClaim(this.user.subject,t).subscribe(n=>{this.currentClaim.editing=!1,this.selectedClaim=void 0,this.optionalClaims.push(this.currentClaim),this.claimsForm.setValue({type:"",value:""});const i=this.translate.instant("Notifications.Saving Success Title"),a=this.translate.instant("Notifications.Saving Success Message");this.toastr.success(i,a),this.user.claims=this.optionalClaims.concat(this.requiredClaims),this.userService.userSubject.next(this.user)},n=>{if(401===n.status)this.toastr.warning(this.translate.instant("UserDetails.UnauthorizedWarning"),this.translate.instant("Notifications.Unauthorized"));else{const i={toastBody:this.translate.instant("Notifications.Saving Error Title"),toastTitle:this.translate.instant("Notifications.Saving Error Message")};(this.errorService.handleError(n,i)&f.I.Toast)!==f.I.Toast&&this.toastr.error(i.toastBody,i.toastTitle)}})}sortClaims(){for(const t of this.claims)for(const n of this.claimTypes)if(n.name===t.type){const i={format:n.valueType,type:t.type,typeId:n.id,displayName:n.displayName,value:t.value,editing:!1,required:n.required};n.rule&&(i.regex=n.rule,i.failureMessage=n.ruleValidationFailureDescription),n.required?this.requiredClaims.push(i):this.optionalClaims.push(i)}}notAllowedToEditClaim(t){return this.apClaimsService.notAllowedToEditClaim(t)}isPolicyClaim(t){return this.apClaimsService.isPolicyClaim(t)}getAllowedValues(t){const n=this.claimTypes.find(i=>i.name===t.type);return n&&n.allowedValues||[]}isClaimInValid(){var t=this.claimsForm.get("value");return!!t&&t.invalid}static{this.\u0275fac=function(n){return new(n||s)(e.rXU(c.ze),e.rXU(g.D),e.rXU(V.X),e.rXU(p.c$),e.rXU(X.I),e.rXU(C.hE),e.rXU(v.tw),e.rXU(x.o),e.rXU(B.B),e.rXU(e.gRc))}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["app-user-additional-details"]],viewQuery:function(n,i){if(1&n&&(e.GBs(ae,5),e.GBs(le,7),e.GBs(oe,7)),2&n){let a;e.mGM(a=e.lsd())&&(i.editClaimsForm=a.first),e.mGM(a=e.lsd())&&(i.addClaimModal=a.first),e.mGM(a=e.lsd())&&(i.deleteClaimModal=a.first)}},decls:76,vars:51,consts:[["addClaimModal","bs-modal"],["deleteClaimModal","bs-modal"],["editClaimsForm","ngForm"],["id","editUserClaims",1,"tw-container","tw-mx-auto"],[1,"cms"],["right",""],[1,"tw-btn-success",3,"click"],["bsModal","","id","addClaimModal","role","dialog","aria-hidden","true","tabindex","-1",1,"modal",3,"config"],[1,"modal-dialog"],[1,"modal-content",3,"formGroup"],[1,"modal-header"],[1,"modal-title"],["type","button",1,"modal-close",3,"click"],["aria-hidden","true",1,"fas","fa-times"],[1,"sr-only"],[1,"modal-body","scrollbars"],[3,"id","label","isLast"],[1,"tw-form-select"],["formControlName","type","id","claimsFormDropdown",1,"tw-form-control",3,"change"],["disabled","","selected",""],[4,"ngFor","ngForOf"],[3,"id","label","isLast",4,"ngIf"],[1,"modal-body-fade"],[1,"modal-footer"],[1,"tw-flex","tw-items-center"],[1,"tw-mr-auto"],["type","submit",1,"tw-btn-success",3,"click","disabled"],[1,"tw-btn-link","tw--mr-4",3,"click"],["class","tw-alert","role","alert",4,"ngIf"],["class","datatable hover",4,"ngIf"],["hidePager","true",3,"totalResults",4,"ngIf"],["bsModal","","id","deleteClaimModal","role","dialog","aria-hidden","true","tabindex","-1",1,"modal",3,"config"],[1,"modal-dialog","modal-dialog--danger"],[1,"modal-content"],[1,"modal-body","tw-text-center","scrollbars"],[1,"tw-mb-4"],[1,"tw-pill-danger",3,"innerHTML"],[1,"tw-btn-danger",3,"click"],[3,"value",4,"ngIf"],[3,"value"],["class","tw-form-control","formControlName","value","type","text","name","string","id","claimsFormInput","required","",3,"appClaimRegex",4,"ngIf"],["class","tw-form-control","formControlName","value","type","number","name","number","id","claimsFormInput","required","",4,"ngIf"],[3,"id","isTraffic","isAlt",4,"ngIf"],["class","tw-w-full sm:tw-max-w-2xl",4,"ngIf"],["class","",3,"id",4,"ngIf"],["class","tw-form-text-danger",4,"ngIf"],["formControlName","value","type","text","name","string","id","claimsFormInput","required","",1,"tw-form-control",3,"appClaimRegex"],["formControlName","value","type","number","name","number","id","claimsFormInput","required","",1,"tw-form-control"],[3,"id","isTraffic","isAlt"],["id","claimsFormInput","formControlName","value","type","checkbox","binary","true",1,"tw-form-switch__input"],[1,"tw-w-full","sm:tw-max-w-2xl"],[4,"ngIf"],["id","claimsFormInput","formControlName","value","required","true"],["id","claimsFormInput","formControlName","value","required","true",3,"displayType"],[1,"",3,"id"],[3,"valueChanged","id","typeId","hostingModal","value"],[1,"tw-form-text-danger"],["role","alert",1,"tw-alert"],[1,"datatable","hover"],[1,"tw-w-1/4"],[1,"tw-w-1"],["id","claimsTable"],["class","claim",3,"ngClass",4,"ngFor","ngForOf"],[1,"claim",3,"ngClass"],[1,"tw-truncate"],["class","tw-pill",4,"ngIf"],["class","tw-flex tw-items-center",4,"ngIf"],[1,"tw-pill"],["value","Edit",1,"tw-btn-link","tw-btn-small","tw-mr-1",3,"click"],["aria-hidden","true",1,"fad","fa-pencil"],["value","Delete",1,"tw-btn-link","tw-btn-small","tw-text-red-500",3,"click"],["class","tw-form-control","type","text","name","claimValue","required","",3,"ngModel","appClaimRegex","ngModelChange",4,"ngIf"],["class","tw-form-control","type","number","name","claimValue","required","",3,"ngModel","ngModelChange",4,"ngIf"],[1,"tw-flex","tw-h-full"],["value","Save",1,"tw-btn-success","tw-mr-2",3,"click","disabled"],["aria-hidden","true",1,"fas","fa-check"],["value","CancelEdit",1,"tw-btn",3,"click"],["type","text","name","claimValue","required","",1,"tw-form-control",3,"ngModelChange","ngModel","appClaimRegex"],["type","number","name","claimValue","required","",1,"tw-form-control",3,"ngModelChange","ngModel"],[1,"tw-form-text"],["id","claimsFormInput","name","claimValue","required","true",3,"ngModelChange","ngModel"],["id","claimsFormInput","name","claimValue","required","true",3,"ngModelChange","ngModel","displayType"],["type","checkbox","name","claimValue",1,"tw-form-switch__input",3,"ngModelChange","id","ngModel"],["name","claimValue",3,"valueChanged","id","typeId","value"],["hidePager","true",3,"totalResults"]],template:function(n,i){if(1&n){const a=e.RV6();e.j41(0,"div",3)(1,"div",4)(2,"p"),e.EFF(3),e.nI1(4,"translate"),e.k0s()(),e.j41(5,"app-action-bar"),e.qex(6,5),e.j41(7,"button",6),e.bIt("click",function(){e.eBV(a);const m=e.sdS(11);return e.Njj(m.show())}),e.EFF(8),e.nI1(9,"translate"),e.k0s(),e.bVm(),e.k0s(),e.j41(10,"div",7,0)(12,"div",8)(13,"form",9)(14,"div",10)(15,"h5",11),e.EFF(16),e.nI1(17,"translate"),e.k0s(),e.j41(18,"button",12),e.bIt("click",function(){return e.eBV(a),e.Njj(i.closeAddModal())}),e.nrm(19,"span",13),e.j41(20,"span",14),e.EFF(21),e.nI1(22,"translate"),e.k0s()()(),e.j41(23,"div",15)(24,"app-form-row",16)(25,"div",17)(26,"select",18),e.bIt("change",function(m){return e.eBV(a),e.Njj(i.changeFormat(m.target.value))}),e.nrm(27,"option",19),e.DNE(28,me,2,1,"ng-container",20),e.k0s()()(),e.DNE(29,be,7,9,"app-form-row",21),e.k0s(),e.nrm(30,"div",22),e.j41(31,"div",23)(32,"div",24)(33,"div",25)(34,"button",26),e.bIt("click",function(){return e.eBV(a),e.Njj(i.addClaim())}),e.EFF(35),e.nI1(36,"translate"),e.k0s()(),e.j41(37,"button",27),e.bIt("click",function(){return e.eBV(a),e.Njj(i.closeAddModal())}),e.EFF(38),e.nI1(39,"translate"),e.k0s()()()()()(),e.DNE(40,Ce,4,3,"div",28)(41,Pe,19,13,"table",29)(42,Je,1,1,"app-pager",30),e.k0s(),e.j41(43,"div",31,1)(45,"div",32)(46,"div",33)(47,"div",10)(48,"h5",11),e.EFF(49),e.nI1(50,"translate"),e.k0s(),e.j41(51,"button",12),e.bIt("click",function(){return e.eBV(a),e.Njj(i.closeDeleteModal())}),e.nrm(52,"span",13),e.j41(53,"span",14),e.EFF(54),e.nI1(55,"translate"),e.k0s()()(),e.j41(56,"div",34)(57,"p",35),e.EFF(58),e.nI1(59,"translate"),e.j41(60,"strong"),e.EFF(61),e.k0s(),e.EFF(62,"?"),e.k0s(),e.nrm(63,"p",36),e.nI1(64,"translate"),e.k0s(),e.nrm(65,"div",22),e.j41(66,"div",23)(67,"div",24)(68,"div",25)(69,"button",37),e.bIt("click",function(){return e.eBV(a),e.Njj(i.deleteClaim(i.toDelete))}),e.EFF(70),e.nI1(71,"translate"),e.k0s()(),e.j41(72,"button",27),e.bIt("click",function(){return e.eBV(a),e.Njj(i.closeDeleteModal())}),e.EFF(73),e.nI1(74,"translate"),e.k0s()()()()()(),e.nrm(75,"app-can-deactivate")}2&n&&(e.R7$(3),e.JRh(e.bMT(4,25,"Users.Details.AdditionalDetailsBody")),e.R7$(5),e.SpI(" ",e.bMT(9,27,"Users.Details.AddClaim")," "),e.R7$(2),e.Y8G("config",e.lJ4(49,O)),e.R7$(3),e.Y8G("formGroup",i.claimsForm),e.R7$(3),e.JRh(e.bMT(17,29,"Users.Details.AddClaim")),e.R7$(5),e.JRh(e.bMT(22,31,"Common.Close")),e.R7$(3),e.Y8G("id","claimsFormDropdown")("label","Common.Type")("isLast",!i.selectedClaim),e.R7$(4),e.Y8G("ngForOf",i.claimTypes),e.R7$(),e.Y8G("ngIf",i.selectedClaim),e.R7$(5),e.Y8G("disabled",!i.claimsForm.valid||!i.selectedClaim),e.R7$(),e.JRh(e.bMT(36,33,"Common.Add")),e.R7$(3),e.JRh(e.bMT(39,35,"Common.Cancel")),e.R7$(2),e.Y8G("ngIf",i.optionalClaims&&i.optionalClaims.length<=0),e.R7$(),e.Y8G("ngIf",(null==i.optionalClaims?null:i.optionalClaims.length)>0),e.R7$(),e.Y8G("ngIf",(null==i.optionalClaims?null:i.optionalClaims.length)>0),e.R7$(),e.Y8G("config",e.lJ4(50,O)),e.R7$(6),e.JRh(e.bMT(50,37,"Common.Delete.Confirm")),e.R7$(5),e.JRh(e.bMT(55,39,"Common.Close")),e.R7$(4),e.SpI("",e.bMT(59,41,"Common.Delete.AreYouSure")," "),e.R7$(3),e.JRh(null==i.toDelete?null:i.toDelete.type),e.R7$(2),e.Y8G("innerHTML",e.bMT(64,43,"Common.Delete.Warning"),e.npT),e.R7$(7),e.JRh(e.bMT(71,45,"Common.Delete.Title")),e.R7$(3),e.JRh(e.bMT(74,47,"Common.Delete.No")))},dependencies:[d.YU,d.Sq,d.bT,c.qT,c.xH,c.y7,c.me,c.Q0,c.Zm,c.wz,c.BC,c.cb,c.YS,c.vS,c.cV,c.j4,c.JD,M.hZ,R.B,ie.n,y.Y,L.m,se.$,ne.j,F.Z,P.E,p.D9,J.r7,J.El],styles:["[_nghost-%COMP%]{width:100%;display:block;position:relative}"]})}}return s})();var I=l(6697),z=l(6303),ze=l(7921),W=l(7384),H=l(8762),Q=l(6406),k=l(8114);const We=["appInfoModal"],He=["revokeAppModal"],_=s=>[s],Qe=()=>[];function Ze(s,o){1&s&&e.nrm(0,"app-simple-loader")}function Ke(s,o){1&s&&(e.j41(0,"div",21)(1,"div"),e.EFF(2),e.nI1(3,"translate"),e.k0s()()),2&s&&(e.R7$(2),e.JRh(e.bMT(3,1,"Users.Applications.None")))}function qe(s,o){if(1&s){const t=e.RV6();e.j41(0,"tr",28)(1,"td",29),e.bIt("click",function(){const i=e.eBV(t).$implicit,a=e.XpG(2);return e.Njj(a.modalInfo(i))}),e.j41(2,"b"),e.EFF(3),e.k0s()(),e.j41(4,"td",30),e.bIt("click",function(){const i=e.eBV(t).$implicit,a=e.XpG(2);return e.Njj(a.modalInfo(i))}),e.EFF(5),e.k0s(),e.j41(6,"td")(7,"button",31),e.bIt("click",function(){const i=e.eBV(t).$implicit,a=e.XpG(2);return e.Njj(a.modalInfo(i))}),e.nrm(8,"span",32),e.j41(9,"span",25),e.EFF(10),e.nI1(11,"translate"),e.k0s()()()()}if(2&s){const t=o.$implicit;e.R7$(3),e.JRh(t.clientName),e.R7$(2),e.SpI(" ",t.clientDescription," "),e.R7$(5),e.JRh(e.bMT(11,3,"Common.Info"))}}function et(s,o){if(1&s&&(e.j41(0,"table",22)(1,"thead")(2,"tr")(3,"th"),e.EFF(4),e.nI1(5,"translate"),e.k0s(),e.j41(6,"th",23),e.EFF(7),e.nI1(8,"translate"),e.k0s(),e.j41(9,"th",24)(10,"span",25),e.EFF(11),e.nI1(12,"translate"),e.k0s()()()(),e.j41(13,"tbody",26),e.DNE(14,qe,12,5,"tr",27),e.k0s()()),2&s){const t=e.XpG();e.R7$(4),e.JRh(e.bMT(5,4,"UserDetails.Name")),e.R7$(3),e.JRh(e.bMT(8,6,"Common.Description")),e.R7$(4),e.JRh(e.bMT(12,8,"Common.Actions")),e.R7$(3),e.Y8G("ngForOf",t.userApps)}}function tt(s,o){if(1&s&&e.nrm(0,"app-pager",33),2&s){const t=e.XpG();e.Y8G("totalResults",null==t.userApps?null:t.userApps.length)}}function it(s,o){1&s&&(e.j41(0,"div",19)(1,"div",34),e.EFF(2),e.nI1(3,"translate"),e.k0s()()),2&s&&(e.R7$(2),e.JRh(e.bMT(3,1,"Users.Applications.DataEncrypted")))}function st(s,o){if(1&s&&(e.j41(0,"li",37)(1,"span",38),e.EFF(2),e.k0s()()),2&s){const t=o.$implicit;e.R7$(2),e.JRh(t)}}function nt(s,o){if(1&s&&(e.j41(0,"dl")(1,"dt",35),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.j41(4,"dd")(5,"ul",36),e.Z7z(6,st,3,1,"li",37,e.fX1),e.k0s()()()),2&s){let t;const n=e.XpG();e.R7$(2),e.JRh(e.bMT(3,1,"Users.Applications.Accessible")),e.R7$(4),e.Dyx(null!==(t=null==n.selectedApp?null:n.selectedApp.scopes)&&void 0!==t?t:e.lJ4(3,Qe))}}let at=(()=>{class s{get ReadOnlyFieldType(){return z.t}constructor(t,n,i,a){this.titleService=t,this.userService=n,this.translate=i,this.toastr=a,this.isLoading=!0,this.isUnavailable=!1}ngOnInit(){this.userService.getCachedUser().pipe((0,I.s)(1)).subscribe(t=>{this.user=t,this.userService.getUserApps(this.user.subject).subscribe(n=>{this.userApps=n,this.isLoading=!1,this.isUnavailable=!1;const i=this.translate.instant("Users.Singular")+" "+this.user.username+" "+this.translate.instant("Nav.Applications")+" - "+b.$9.SITE_TITLE;this.titleService.setTitle(i)},n=>{this.isLoading=!1})})}modalInfo(t){this.selectedApp=t,this.selectedAppMap=new ze.b(t),this.appInfoModal.show()}revokeAll(){this.userService.revokeAllUserApps(this.user.subject).subscribe(t=>{this.toastr.success(this.translate.instant("Notifications.AllAppsRevoked"),this.translate.instant("Notifications.Success")),this.userApps=[]},t=>{this.toastr.error(t,this.translate.instant("Notifications.Failure"))})}revokeSingle(t){this.userService.revokeSingleUserApp(this.user.subject,t).subscribe(n=>{this.toastr.success(this.translate.instant("Notifications.AppRevoked"),this.translate.instant("Notifications.Success"));const i=this.userApps.findIndex(a=>a.clientId===t);this.userApps.splice(i,1)},n=>{this.toastr.error(n,this.translate.instant("Notifications.Failure"))})}static{this.\u0275fac=function(n){return new(n||s)(e.rXU(C.hE),e.rXU(g.D),e.rXU(p.c$),e.rXU(v.tw))}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["app-user-applications"]],viewQuery:function(n,i){if(1&n&&(e.GBs(We,5),e.GBs(He,5)),2&n){let a;e.mGM(a=e.lsd())&&(i.appInfoModal=a.first),e.mGM(a=e.lsd())&&(i.revokeAppModal=a.first)}},decls:56,vars:82,consts:[["revokeAllModal",""],["appInfoModal",""],["revokeAppModal",""],["id","editUserApplications",1,"tw-container","tw-mx-auto"],[1,"cms"],[4,"ngIf"],["class","tw-alert","role","alert",4,"ngIf"],["class","datatable selectable hover",4,"ngIf"],["hidePager","true",3,"totalResults",4,"ngIf"],["right",""],[1,"tw-btn-danger","tw-mb-3",3,"click","disabled"],[3,"confirm","modalId","type","buttonType","title","okText","cancelText"],["body",""],[1,"tw-mb-4"],[1,"tw-pill-danger"],[3,"confirm","modalId","buttonType","title","okText"],[3,"id","label"],[3,"fieldType","values"],[3,"fieldType","values","customNoValue"],["role","alert",1,"tw-alert-warning"],[3,"confirm","modalId","type","buttonType","title","okText"],["role","alert",1,"tw-alert"],[1,"datatable","selectable","hover"],[1,"tw-hidden","md:tw-table-cell"],[1,"tw-w-1"],[1,"sr-only"],["id","userAppList"],["class","group",4,"ngFor","ngForOf"],[1,"group"],[1,"tw-max-w-0","tw-truncate",3,"click"],[1,"tw-hidden","tw-max-w-0","tw-truncate","md:tw-table-cell",3,"click"],[1,"tw-btn-link","tw-btn-small","group-hover:tw-text-blue-500",3,"click"],["aria-hidden","true",1,"fad","fa-pencil"],["hidePager","true",3,"totalResults"],["id","DataEncryptedWarning"],[1,"tw-font-semibold","tw-text-sm","tw-mb-2"],[1,"tw-flex","tw-flex-wrap","tw-item-start","tw--mt-2","tw--ml-2"],[1,"tw-pt-2","tw-pl-2"],[1,"tw-pill"]],template:function(n,i){if(1&n){const a=e.RV6();e.j41(0,"div",3)(1,"div",4)(2,"p"),e.EFF(3),e.nI1(4,"translate"),e.k0s()(),e.DNE(5,Ze,1,0,"app-simple-loader",5)(6,Ke,4,3,"div",6)(7,et,15,10,"table",7)(8,tt,1,1,"app-pager",8),e.k0s(),e.j41(9,"app-button-bar"),e.qex(10,9),e.j41(11,"button",10),e.bIt("click",function(){e.eBV(a);const m=e.sdS(15);return e.Njj(m.show())}),e.EFF(12),e.nI1(13,"translate"),e.k0s(),e.bVm(),e.k0s(),e.j41(14,"app-confirmation-modal",11,0),e.bIt("confirm",function(){return e.eBV(a),e.Njj(i.revokeAll())}),e.qex(16,12),e.j41(17,"p",13),e.EFF(18),e.nI1(19,"translate"),e.k0s(),e.j41(20,"p",14),e.EFF(21),e.nI1(22,"translate"),e.k0s(),e.bVm(),e.k0s(),e.j41(23,"app-confirmation-modal",15,1),e.bIt("confirm",function(){e.eBV(a);const m=e.sdS(41);return e.Njj(m.show())}),e.qex(25,12),e.j41(26,"app-form-row",16),e.nrm(27,"app-readonly",17),e.k0s(),e.j41(28,"app-form-row",16),e.nrm(29,"app-readonly",17),e.k0s(),e.j41(30,"app-form-row",16),e.nrm(31,"app-readonly",17),e.k0s(),e.j41(32,"app-form-row",16),e.nrm(33,"app-readonly",17),e.k0s(),e.j41(34,"app-form-row",16),e.nrm(35,"app-readonly",17),e.k0s(),e.j41(36,"app-form-row",16),e.nrm(37,"app-readonly",18),e.k0s(),e.DNE(38,it,4,3,"div",19)(39,nt,8,4,"dl"),e.bVm(),e.k0s(),e.j41(40,"app-confirmation-modal",20,2),e.bIt("confirm",function(){return e.eBV(a),e.Njj(i.revokeSingle(null==i.selectedApp?null:i.selectedApp.clientId))}),e.qex(42,12),e.j41(43,"p",13),e.EFF(44),e.nI1(45,"translate"),e.j41(46,"strong"),e.EFF(47),e.k0s(),e.EFF(48),e.nI1(49,"translate"),e.j41(50,"strong"),e.EFF(51),e.k0s(),e.EFF(52,"."),e.k0s(),e.j41(53,"p"),e.EFF(54),e.nI1(55,"translate"),e.k0s(),e.bVm(),e.k0s()}2&n&&(e.R7$(3),e.JRh(e.bMT(4,56,"Users.Applications.Access")),e.R7$(2),e.Y8G("ngIf",i.isLoading),e.R7$(),e.Y8G("ngIf",0==(null==i.userApps?null:i.userApps.length)&&!i.isLoading),e.R7$(),e.Y8G("ngIf",(null==i.userApps?null:i.userApps.length)>0),e.R7$(),e.Y8G("ngIf",(null==i.userApps?null:i.userApps.length)>0&&!i.isLoading),e.R7$(3),e.Y8G("disabled",(null==i.userApps?null:i.userApps.length)<=0),e.R7$(),e.SpI(" ",e.bMT(13,58,"Users.Applications.RevokeAll")," "),e.R7$(2),e.Y8G("modalId","revokeAllModal")("type","danger")("buttonType","danger")("title","Users.Applications.RevokeAll")("okText","Users.Applications.RevokeAll")("cancelText","Users.Applications.DontRevokeAll"),e.R7$(4),e.JRh(e.bMT(19,60,"Users.Applications.RevokeConfirm")),e.R7$(3),e.JRh(e.bMT(22,62,"Common.Delete.Warning")),e.R7$(2),e.Y8G("modalId","appInfoModal")("buttonType","danger")("title",null==i.selectedApp?null:i.selectedApp.clientName)("okText","Users.Applications.Revoke"),e.R7$(3),e.Y8G("id","selectedAppName")("label","Common.Name"),e.R7$(),e.Y8G("fieldType",i.ReadOnlyFieldType.Single)("values",e.eq3(70,_,null==i.selectedAppMap?null:i.selectedAppMap.clientName)),e.R7$(),e.Y8G("id","selectedAppName")("label","Common.LogoURL"),e.R7$(),e.Y8G("fieldType",i.ReadOnlyFieldType.Single)("values",e.eq3(72,_,null==i.selectedAppMap?null:i.selectedAppMap.clientLogoUrl)),e.R7$(),e.Y8G("id","selectedAppDescription")("label","Common.Description"),e.R7$(),e.Y8G("fieldType",i.ReadOnlyFieldType.Multi)("values",e.eq3(74,_,null==i.selectedAppMap?null:i.selectedAppMap.clientDescription)),e.R7$(),e.Y8G("id","selectedAppURL")("label","Common.URL"),e.R7$(),e.Y8G("fieldType",i.ReadOnlyFieldType.Single)("values",e.eq3(76,_,null==i.selectedAppMap?null:i.selectedAppMap.clientUrl)),e.R7$(),e.Y8G("id","selectedAppCreated")("label","Common.Created"),e.R7$(),e.Y8G("fieldType",i.ReadOnlyFieldType.Single)("values",e.eq3(78,_,null==i.selectedAppMap?null:i.selectedAppMap.created)),e.R7$(),e.Y8G("id","selectedAppExpires")("label","Common.Expires"),e.R7$(),e.Y8G("fieldType",i.ReadOnlyFieldType.Single)("values",e.eq3(80,_,null==i.selectedAppMap?null:i.selectedAppMap.expires))("customNoValue","Common.Never"),e.R7$(),e.vxM(38,(null==i.selectedApp?null:i.selectedApp.scopes.length)<1?38:-1),e.R7$(),e.vxM(39,(null==i.selectedApp?null:i.selectedApp.scopes.length)>0?39:-1),e.R7$(),e.Y8G("modalId","revokeAppModal")("type","danger")("buttonType","danger")("title","Users.Applications.RevokeApp")("okText","Users.Applications.RevokeYes"),e.R7$(4),e.SpI("",e.bMT(45,64,"Users.Applications.RevokeUserConfirm")," "),e.R7$(3),e.JRh(null==i.selectedApp?null:i.selectedApp.clientName),e.R7$(),e.SpI(" ",e.bMT(49,66,"Users.Applications.ForUser")," "),e.R7$(3),e.JRh(i.user.username),e.R7$(3),e.JRh(e.bMT(55,68,"Common.AreYouSureContinue")))},dependencies:[d.Sq,d.bT,R.B,W.d,y.Y,H.O,Q.z,k.B,p.D9],styles:["[_nghost-%COMP%]{width:100%;display:block;position:relative}"]})}}return s})();var j=l(6145),D=l(7263),lt=l(316),ot=l(9196),rt=l(4701),ct=l(7778),mt=l(4692);const pt=["claimsComponent"],dt=s=>[s];function ut(s,o){1&s&&(e.j41(0,"app-form-row",22),e.nrm(1,"app-date-time",33),e.k0s()),2&s&&(e.Y8G("id","LockoutEnd")("label","Users.LockoutEnd"),e.R7$(),e.Y8G("displayType","datetime"))}function ft(s,o){if(1&s){const t=e.RV6();e.j41(0,"form",21)(1,"app-form-row",22)(2,"app-form-toggle",23),e.nrm(3,"input",24),e.k0s()(),e.j41(4,"app-form-row",22),e.nrm(5,"app-readonly",25),e.nI1(6,"readOnlyValue"),e.k0s(),e.j41(7,"app-form-row",26)(8,"input",27),e.bIt("keyup",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.checkForPolicyUserForm("firstName","given_name",null==i.userForm.controls.firstName?null:i.userForm.controls.firstName.value))}),e.k0s()(),e.j41(9,"app-form-row",26)(10,"input",28),e.bIt("keyup",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.checkForPolicyUserForm("lastName","family_name",null==i.userForm.controls.lastName?null:i.userForm.controls.lastName.value))}),e.k0s()(),e.j41(11,"app-form-row",26)(12,"input",29),e.bIt("keyup",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.checkForPolicyUserForm("username","name",null==i.userForm.controls.username?null:i.userForm.controls.username.value))}),e.k0s()(),e.j41(13,"app-form-row",26)(14,"input",30),e.bIt("keyup",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.checkForPolicyUserForm("email","email",null==i.userForm.controls.email?null:i.userForm.controls.email.value))}),e.k0s()(),e.j41(15,"app-form-row",22)(16,"app-form-toggle",23)(17,"input",31),e.bIt("change",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.clearLockoutEnd())}),e.k0s()()(),e.DNE(18,ut,2,3,"app-form-row",32),e.k0s()}if(2&s){const t=e.XpG();e.Y8G("formGroup",t.userForm),e.R7$(),e.Y8G("id","Blocked")("label","UserDetails.Active"),e.R7$(),e.Y8G("id","Blocked")("isTraffic",!0)("isAlt",!0),e.R7$(2),e.Y8G("id","userId")("label","Common.ID"),e.R7$(),e.Y8G("fieldType",t.ReadOnlyFieldType.Single)("values",e.eq3(30,dt,e.bMT(6,28,t.user.subject))),e.R7$(2),e.Y8G("id","FirstName")("label","Users.FirstName")("help",t.ifUserInfoPolicyClaim("given_name",null==t.userForm.controls.firstName?null:t.userForm.controls.firstName.value)?"Common.Policy":""),e.R7$(2),e.Y8G("id","LastName")("label","Users.LastName")("help",t.ifUserInfoPolicyClaim("family_name",null==t.userForm.controls.lastName?null:t.userForm.controls.lastName.value)?"Common.Policy":""),e.R7$(2),e.Y8G("id","Username")("label","Users.Username")("help",t.ifUserInfoPolicyClaim("name",null==t.userForm.controls.username?null:t.userForm.controls.username.value)?"Common.Policy":""),e.R7$(2),e.Y8G("id","Email")("label","Users.Email")("help",t.ifUserInfoPolicyClaim("email",null==t.userForm.controls.email?null:t.userForm.controls.email.value)?"Common.Policy":""),e.R7$(2),e.Y8G("id","LockoutEnabled")("label","Users.LockoutEnabled"),e.R7$(),e.Y8G("id","LockoutEnabled")("isTraffic",!0)("isAlt",!1),e.R7$(2),e.Y8G("ngIf",null==t.userForm.controls.lockoutEnabled?null:t.userForm.controls.lockoutEnabled.value)}}function _t(s,o){if(1&s&&(e.j41(0,"form",21)(1,"app-form-row",34)(2,"app-form-toggle",23),e.nrm(3,"input",35),e.k0s()()()),2&s){const t=e.XpG();e.Y8G("formGroup",t.userForm),e.R7$(),e.Y8G("id","EnabledTwoFactor")("label","UserDetails.EnabledTwoFactor")("help","UserDetails.EnabledTwoFactorHelp")("isLast",!0),e.R7$(),e.Y8G("id","EnabledTwoFactor")("isTraffic",!0)("isAlt",!1)}}function ht(s,o){if(1&s){const t=e.RV6();e.j41(0,"button",36),e.bIt("click",function(){e.eBV(t);const i=e.XpG(),a=e.sdS(26),r=e.sdS(35);return e.Njj(i.passwordWebhookSetup?a.show():r.show())}),e.EFF(1),e.nI1(2,"translate"),e.k0s()}2&s&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"UserDetails.ChangePassword")," "))}function gt(s,o){if(1&s){const t=e.RV6();e.j41(0,"button",37),e.bIt("click",function(){e.eBV(t);const i=e.XpG(),a=e.sdS(41),r=e.sdS(50);return e.Njj(i.resetMfaWebhookSetup?a.show():r.show())}),e.EFF(1),e.nI1(2,"translate"),e.k0s()}2&s&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"UserDetails.ResetMfa")," "))}function vt(s,o){if(1&s){const t=e.RV6();e.j41(0,"button",38),e.bIt("click",function(){e.eBV(t),e.XpG();const i=e.sdS(15);return e.Njj(i.show())}),e.EFF(1),e.nI1(2,"translate"),e.k0s()}2&s&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"Common.Delete.Title")," "))}function bt(s,o){if(1&s){const t=e.RV6();e.j41(0,"button",39),e.bIt("click",function(){e.eBV(t),e.XpG();const i=e.sdS(17);return e.Njj(i.show())}),e.EFF(1),e.nI1(2,"translate"),e.k0s()}2&s&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"Common.Delete.UndoDelete")," "))}let Ct=(()=>{class s{get ReadOnlyFieldType(){return z.t}constructor(t,n,i,a,r,m,u,S,$,w,qt,ei){this.fb=t,this.userService=n,this.errorService=i,this.router=a,this.translate=r,this.claimsService=m,this.dialogService=u,this.titleService=S,this.toastr=$,this.localize=w,this.configService=qt,this.apClaimsService=ei,this.isDeleting=!1,this.requiredCount=0,this.dateTimeDisplayType=F.e,this.inFlight=!1}ngOnInit(){this.combinedObservable=this.claimsService.getClaimTypes(null,null).pipe((0,N.v)(this.userService.getCachedUser()),(0,Y.T)(([t,n])=>({claimTypes:t,user:n})),(0,T.$)()).subscribe({next:t=>{this.user=t.user,this.claimTypes=t.claimTypes,this.createForms();const n=this.translate.instant("Users.Singular")+" "+this.user.username+" "+this.translate.instant("Nav.Details")+" - "+b.$9.SITE_TITLE;this.titleService.setTitle(n)},error:t=>{this.errorService.handleError(t)}}),this.configService.getConfig(!0).pipe((0,I.s)(1)).subscribe(t=>{this.passwordWebhookSetup=t.resetPasswordConfigured,this.resetMfaWebhookSetup=t.resetMfaConfigured})}ngOnDestroy(){this.combinedObservable.unsubscribe()}createForms(){this.userForm=this.fb.group({subject:[this.user.subject,c.k0.required],username:[{value:this.user.username,disabled:this.notAllowedToEditUserInfo("name",this.user.username)},[c.k0.required,(0,D.Zt)()]],email:[{value:this.user.email,disabled:this.notAllowedToEditUserInfo("name",this.user.email)},[c.k0.required,lt.D]],firstName:[{value:this.user.firstName,disabled:this.notAllowedToEditUserInfo("given_name",this.user.firstName)},c.k0.required],lastName:[{value:this.user.lastName,disabled:this.notAllowedToEditUserInfo("family_name",this.user.lastName)},c.k0.required],isBlocked:[this.user.isBlocked,c.k0.required],lockoutEnd:[this.user.lockoutEnd],lockoutEnabled:[this.user.lockoutEnabled],isDeleted:[this.user.isDeleted],twoFactorEnabled:[this.user.twoFactorEnabled]})}canDeactivate(){return!!this.isDeleting||!this.claimsComponent.claimsForm.dirty&&!this.userForm.dirty||(this.dialogService.confirm(),this.dialogService.eventStream)}deleteUser(){this.userService.deleteUser(this.user).subscribe(t=>{this.isDeleting=!0;const n=this.localize.translateRoute("/users");this.router.navigate([n]);const i=this.translate.instant("Users.Delete.Confirmation").replace("{0}",this.user.username);this.toastr.success(i,this.translate.instant("Notifications.Saving Success Title"))},t=>{const n={toastBody:this.translate.instant("Notifications.Delete Error Title"),toastTitle:this.translate.instant("Notifications.Delete User Message")};(this.errorService.handleError(t,n)&f.I.Toast)!==f.I.Toast&&this.toastr.error(n.toastBody,n.toastTitle)})}unDeleteUser(){const t=JSON.parse(JSON.stringify(this.user));t.isDeleted=!1,this.userService.updateUser(t).subscribe({next:n=>{this.user=t,this.userService.userSubject.next(t);const i=this.translate.instant("Notifications.Saving Success Title"),a=this.translate.instant("Notifications.Saving Success Message");this.toastr.success(a,i)},error:n=>{this.errorService.handleError(n)}})}submit(){const t=this.userForm.value,n=this.user.claims.slice();for(const a of n){const r=this.claimsComponent.requiredClaims.find(m=>a.type===m.type);r&&(a.value=r.value)}this.claimsComponent.requiredClaims.forEach(a=>{void 0===n.find(m=>m.type===a.type)&&n.push(a)});const i=Object.assign(t,{claims:n},{roles:this.user.roles});this.userService.updateUser(i).subscribe({next:a=>{this.userForm.controls.username.dirty&&(this.user.username=this.userForm.controls.username.value);const r=this.translate.instant("Notifications.Saving Success Title"),m=this.translate.instant("Notifications.Saving Success Message");this.toastr.success(m,r),this.userService.userSubject.next(i),this.userForm.markAsPristine(),this.userForm.markAsUntouched(),this.claimsComponent.claimsForm.form.markAsUntouched(),this.claimsComponent.claimsForm.form.markAsPristine()},error:a=>{this.errorService.handleError(a)}})}resetPassword(){this.inFlight=!0,this.userService.resetPassword(this.user.subject).subscribe(t=>{this.inFlight=!1;const n=this.translate.instant("Notifications.Saving Success Title"),i=this.translate.instant("Notifications.Reset Success Message");this.toastr.success(i,n)},t=>{this.inFlight=!1,this.errorService.handleError(t)})}resetMfa(){this.inFlight=!0,this.userService.resetMfa(this.user.subject).subscribe(t=>{this.inFlight=!1;const n=this.translate.instant("Notifications.Saving Success Title"),i=this.translate.instant("Notifications.Reset Success Message");this.toastr.success(i,n)},t=>{this.inFlight=!1,this.errorService.handleError(t)})}ifUserInfoPolicyClaim(t,n){const i=new j.J;return i.type=t,i.value=n,this.apClaimsService.isPolicyClaim(i)}notAllowedToEditUserInfo(t,n){const i=new j.J;return i.type=t,i.value=n,this.apClaimsService.notAllowedToEditClaim(i)}notAllowedToEditClaim(t){return this.apClaimsService.notAllowedToEditClaim(t)}getHelpTextString(t){return this.apClaimsService.isPolicyClaim(t)?"DateTime"==t.format?"Common.PolicyWithUTCNotice":"Common.Policy":"DateTime"==t.format?"Common.Dates.UTCWarning":""}checkForPolicyUserForm(t,n,i){const a=new j.J;a.type=n,a.value=i,this.apClaimsService.notAllowedToEditClaim(a)&&this.userForm.controls[t].setErrors({incorrect:!0})}getClaimType(t){return this.claimTypes.find(n=>n.name===t.type)}getAllowedValues(t){const n=this.claimTypes.find(i=>i.name===t.type);return n&&n.allowedValues||[]}clearLockoutEnd(){this.userForm.get("lockoutEnd").reset()}goToLink(t){window.open(t,"_blank")}static{this.\u0275fac=function(n){return new(n||s)(e.rXU(c.ze),e.rXU(g.D),e.rXU(X.I),e.rXU(h.Ix),e.rXU(p.c$),e.rXU(V.X),e.rXU(x.o),e.rXU(C.hE),e.rXU(v.tw),e.rXU(A.QG),e.rXU(ot.w),e.rXU(B.B))}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["app-user-details"]],viewQuery:function(n,i){if(1&n&&e.GBs(pt,7),2&n){let a;e.mGM(a=e.lsd())&&(i.claimsComponent=a.first)}},decls:56,vars:54,consts:[["claimsComponent",""],["deleteUserModal",""],["unDeleteUserModal",""],["resetPasswordModal",""],["resetPasswordSetupModal",""],["resetMfaModal",""],["resetMfaSetupModal",""],["id","editUserDetails",1,"tw-container","tw-mx-auto"],[3,"formGroup",4,"ngIf"],["id","requiredClaimsComponent",3,"claimTypes","claims"],["id","submitBtn",1,"tw-btn-success","tw-mr-3","tw-mb-3",3,"click","disabled"],["class","tw-btn tw-mr-3 tw-mb-3","data-toggle","modal","id","resetPasswordButton","type","button",3,"click",4,"ngIf"],["class","tw-btn tw-mr-3 tw-mb-3","data-toggle","modal","id","resetMfaButton","type","button",3,"click",4,"ngIf"],["right",""],["class","tw-btn-danger tw-mb-3","type","button","data-toggle","modal",3,"click",4,"ngIf"],["id","undoDelete","class","tw-btn-danger tw-mb-3","type","button","data-toggle","modal",3,"click",4,"ngIf"],[3,"delete","modalId","resourceName","warning"],[3,"confirm","modalId","type","buttonType","title","okText"],["body",""],[3,"confirm","modalId","title","okText","inFlight"],[3,"confirm","modalId","buttonType","title","okText"],[3,"formGroup"],[3,"id","label"],[3,"id","isTraffic","isAlt"],["id","Blocked","formControlName","isBlocked","type","checkbox",1,"tw-form-switch__input"],[3,"fieldType","values"],[3,"id","label","help"],["type","text","name","FirstName","id","FirstName","formControlName","firstName","required","",1,"tw-form-control",3,"keyup"],["type","text","name","LastName","id","LastName","formControlName","lastName","required","",1,"tw-form-control",3,"keyup"],["type","text","name","Username","id","Username","formControlName","username","required","",1,"tw-form-control",3,"keyup"],["type","email","name","Email","id","Email","formControlName","email","required","",1,"tw-form-control",3,"keyup"],["id","LockoutEnabled","formControlName","lockoutEnabled","type","checkbox",1,"tw-form-switch__input",3,"change"],[3,"id","label",4,"ngIf"],["id","LockoutEnd","name","lockoutEnd","formControlName","lockoutEnd","aria-describedby","toErrorLabel",3,"displayType"],[3,"id","label","help","isLast"],["id","EnabledTwoFactor","formControlName","twoFactorEnabled","type","checkbox",1,"tw-form-switch__input"],["data-toggle","modal","id","resetPasswordButton","type","button",1,"tw-btn","tw-mr-3","tw-mb-3",3,"click"],["data-toggle","modal","id","resetMfaButton","type","button",1,"tw-btn","tw-mr-3","tw-mb-3",3,"click"],["type","button","data-toggle","modal",1,"tw-btn-danger","tw-mb-3",3,"click"],["id","undoDelete","type","button","data-toggle","modal",1,"tw-btn-danger","tw-mb-3",3,"click"]],template:function(n,i){if(1&n){const a=e.RV6();e.j41(0,"div",7),e.DNE(1,ft,19,32,"form",8),e.nrm(2,"app-required-claims-form",9,0),e.DNE(4,_t,4,8,"form",8),e.k0s(),e.j41(5,"app-button-bar")(6,"button",10),e.bIt("click",function(){return e.eBV(a),e.Njj(i.submit())}),e.EFF(7),e.nI1(8,"translate"),e.k0s(),e.DNE(9,ht,3,3,"button",11)(10,gt,3,3,"button",12),e.qex(11,13),e.DNE(12,vt,3,3,"button",14)(13,bt,3,3,"button",15),e.bVm(),e.k0s(),e.j41(14,"app-delete-confirmation-modal",16,1),e.bIt("delete",function(){return e.eBV(a),e.Njj(i.deleteUser())}),e.k0s(),e.j41(16,"app-confirmation-modal",17,2),e.bIt("confirm",function(){return e.eBV(a),e.Njj(i.unDeleteUser())}),e.qex(18,18),e.j41(19,"p"),e.EFF(20),e.nI1(21,"translate"),e.j41(22,"strong"),e.EFF(23),e.k0s(),e.EFF(24,"?"),e.k0s(),e.bVm(),e.k0s(),e.j41(25,"app-confirmation-modal",19,3),e.bIt("confirm",function(){return e.eBV(a),e.Njj(i.resetPassword())}),e.qex(27,18),e.j41(28,"p"),e.EFF(29),e.nI1(30,"translate"),e.j41(31,"strong"),e.EFF(32),e.k0s(),e.EFF(33,"?"),e.k0s(),e.bVm(),e.k0s(),e.j41(34,"app-confirmation-modal",20,4),e.bIt("confirm",function(){return e.eBV(a),e.Njj(i.goToLink("documentation/Webhooks/webhooks.html"))}),e.qex(36,18),e.j41(37,"p"),e.EFF(38),e.nI1(39,"translate"),e.k0s(),e.bVm(),e.k0s(),e.j41(40,"app-confirmation-modal",19,5),e.bIt("confirm",function(){return e.eBV(a),e.Njj(i.resetPassword())}),e.qex(42,18),e.j41(43,"p"),e.EFF(44),e.nI1(45,"translate"),e.j41(46,"strong"),e.EFF(47),e.k0s(),e.EFF(48,"?"),e.k0s(),e.bVm(),e.k0s(),e.j41(49,"app-confirmation-modal",20,6),e.bIt("confirm",function(){return e.eBV(a),e.Njj(i.goToLink("documentation/Webhooks/webhooks.html"))}),e.qex(51,18),e.j41(52,"p"),e.EFF(53),e.nI1(54,"translate"),e.k0s(),e.bVm(),e.k0s(),e.nrm(55,"app-can-deactivate")}if(2&n){const a=e.sdS(3);e.R7$(),e.Y8G("ngIf",i.user),e.R7$(),e.Y8G("claimTypes",i.claimTypes)("claims",null==i.user?null:i.user.claims),e.R7$(2),e.Y8G("ngIf",i.user),e.R7$(2),e.Y8G("disabled",(null==i.userForm?null:i.userForm.invalid)||!a.isFormValid()||(null==i.userForm?null:i.userForm.pristine)&&(null==a.claimsForm?null:a.claimsForm.form.pristine)),e.R7$(),e.SpI(" ",e.bMT(8,42,"Common.Save")," "),e.R7$(2),e.Y8G("ngIf",!(null!=i.user&&i.user.isDeleted)),e.R7$(),e.Y8G("ngIf",!(null!=i.user&&i.user.isDeleted)),e.R7$(2),e.Y8G("ngIf",!(null!=i.user&&i.user.isDeleted)),e.R7$(),e.Y8G("ngIf",null==i.user?null:i.user.isDeleted),e.R7$(),e.Y8G("modalId","deleteUserModal")("resourceName",null==i.user?null:i.user.username)("warning","Users.Delete.AuditingPurposes"),e.R7$(2),e.Y8G("modalId","unDeleteUserModal")("type","danger")("buttonType","danger")("title","Common.Delete.UndoDelete")("okText","Common.Delete.TitleUndo"),e.R7$(4),e.SpI("",e.bMT(21,44,"Common.Delete.ConfirmUndoDelete")," "),e.R7$(3),e.JRh(null==i.user?null:i.user.username),e.R7$(2),e.Y8G("modalId","resetPasswordModal")("title","Common.ResetPassword.Confirm")("okText","Common.ResetPassword.Title")("inFlight",i.passwordWebhookSetup&&i.inFlight),e.R7$(4),e.SpI("",e.bMT(30,46,"Common.ResetPassword.AreYouSureSimple")," "),e.R7$(3),e.JRh(null==i.user?null:i.user.username),e.R7$(2),e.Y8G("modalId","resetPasswordSetupModal")("buttonType",null)("title","Common.ResetPassword.HowToSetupTitle")("okText","Common.Documentation"),e.R7$(4),e.JRh(e.bMT(39,48,"Common.ResetPassword.HowToSetup")),e.R7$(2),e.Y8G("modalId","resetMfaModal")("title","Common.ResetMfa.Confirm")("okText","Common.ResetMfa.Title")("inFlight",i.inFlight),e.R7$(4),e.SpI("",e.bMT(45,50,"Common.ResetMfa.AreYouSureSimple")," "),e.R7$(3),e.JRh(null==i.user?null:i.user.username),e.R7$(2),e.Y8G("modalId","resetMfaSetupModal")("buttonType",null)("title","Common.ResetMfa.HowToSetupTitle")("okText","Common.Documentation"),e.R7$(4),e.JRh(e.bMT(54,52,"Common.ResetMfa.HowToSetup"))}},dependencies:[d.bT,c.qT,c.me,c.Zm,c.BC,c.cb,c.YS,c.j4,c.JD,y.Y,L.m,rt.u,F.Z,H.O,P.E,Q.z,k.B,ct.w,p.D9,mt.u],styles:["[_nghost-%COMP%]{width:100%;display:block;position:relative}"]})}}return s})();function Tt(s,o){1&s&&e.nrm(0,"app-simple-loader")}function Rt(s,o){1&s&&(e.j41(0,"div",8)(1,"div"),e.EFF(2),e.nI1(3,"translate"),e.k0s()()),2&s&&(e.R7$(2),e.JRh(e.bMT(3,1,"UserLogins.NoLogins")))}function yt(s,o){if(1&s){const t=e.RV6();e.j41(0,"tr")(1,"td",16)(2,"b"),e.EFF(3),e.k0s()(),e.j41(4,"td",17),e.EFF(5),e.k0s(),e.j41(6,"td",17),e.EFF(7),e.k0s(),e.j41(8,"td")(9,"button",18),e.bIt("click",function(){const i=e.eBV(t).$implicit,a=e.XpG(2),r=e.sdS(6);return a.modalInfo(i),e.Njj(r.show())}),e.nrm(10,"span",19),e.j41(11,"span",13),e.EFF(12),e.nI1(13,"translate"),e.k0s()()()()}if(2&s){const t=o.$implicit;e.R7$(3),e.JRh(t.providerDisplayName),e.R7$(2),e.JRh(t.loginProvider),e.R7$(2),e.JRh(t.providerKey),e.R7$(5),e.JRh(e.bMT(13,4,"Common.Revoke"))}}function Ft(s,o){if(1&s&&(e.j41(0,"table",9)(1,"thead")(2,"tr")(3,"th",10),e.EFF(4),e.nI1(5,"translate"),e.k0s(),e.j41(6,"th",11),e.EFF(7),e.nI1(8,"translate"),e.k0s(),e.j41(9,"th",11),e.EFF(10),e.nI1(11,"translate"),e.k0s(),e.j41(12,"th",12)(13,"span",13),e.EFF(14),e.nI1(15,"translate"),e.k0s()()()(),e.j41(16,"tbody",14),e.DNE(17,yt,14,6,"tr",15),e.k0s()()),2&s){const t=e.XpG();e.R7$(4),e.JRh(e.bMT(5,5,"UserLogins.ProviderDisplayName")),e.R7$(3),e.JRh(e.bMT(8,7,"UserLogins.LoginProvider")),e.R7$(3),e.JRh(e.bMT(11,9,"UserLogins.ProviderKey")),e.R7$(4),e.JRh(e.bMT(15,11,"Common.Actions")),e.R7$(3),e.Y8G("ngForOf",t.userLogins)}}function It(s,o){if(1&s&&e.nrm(0,"app-pager",20),2&s){const t=e.XpG();e.Y8G("totalResults",null==t.userLogins?null:t.userLogins.length)}}let kt=(()=>{class s{constructor(t,n,i){this.userService=t,this.translate=n,this.toastr=i,this.userLogins=[],this.isLoading=!0}ngOnInit(){this.userService.getCachedUser().pipe((0,I.s)(1)).subscribe(t=>{this.user=t,this.userService.getUserLogins(this.user.subject).subscribe(n=>{this.userLogins=n,this.isLoading=!1})})}modalInfo(t){this.selectedLogin=t}deleteLogin(t){this.userService.revokeUserLogin(this.user.subject,t).subscribe(()=>{this.toastr.success("Login Revoked",this.translate.instant("Notifications.Success")),this.userLogins.splice(this.userLogins.indexOf(t),1)},n=>{this.toastr.error(n,this.translate.instant("Notifications.Failure"))})}static{this.\u0275fac=function(n){return new(n||s)(e.rXU(g.D),e.rXU(p.c$),e.rXU(v.tw))}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["app-user-logins"]],decls:13,vars:13,consts:[["revokeLoginModal",""],[1,"tw-container","tw-mx-auto"],[4,"ngIf"],["class","tw-alert","role","alert",4,"ngIf"],["class","datatable hover",4,"ngIf"],["hidePager","true",3,"totalResults",4,"ngIf"],[3,"confirm","modalId","type","buttonType","title","okText"],["body",""],["role","alert",1,"tw-alert"],[1,"datatable","hover"],[1,"md:tw-w-1/4"],[1,"tw-hidden","md:tw-table-cell"],[1,"tw-w-1"],[1,"sr-only"],["id","userLoginsList"],[4,"ngFor","ngForOf"],[1,"tw-max-w-0","tw-truncate"],[1,"tw-hidden","tw-max-w-0","tw-truncate","md:tw-table-cell"],["value","Delete","data-dismiss","modal","data-toggle","modal","data-target","#revokeLoginModal",1,"tw-btn-link","tw-btn-small","tw-text-red-500",3,"click"],["aria-hidden","true",1,"fas","fa-plug"],["hidePager","true",3,"totalResults"]],template:function(n,i){if(1&n){const a=e.RV6();e.j41(0,"div",1),e.DNE(1,Tt,1,0,"app-simple-loader",2)(2,Rt,4,3,"div",3)(3,Ft,18,13,"table",4)(4,It,1,1,"app-pager",5),e.k0s(),e.j41(5,"app-confirmation-modal",6,0),e.bIt("confirm",function(){return e.eBV(a),e.Njj(i.deleteLogin(i.selectedLogin))}),e.qex(7,7),e.j41(8,"p"),e.EFF(9),e.nI1(10,"translate"),e.j41(11,"b"),e.EFF(12),e.k0s()(),e.bVm(),e.k0s()}if(2&n){let a;e.R7$(),e.Y8G("ngIf",i.isLoading),e.R7$(),e.Y8G("ngIf",0==(null==i.userLogins?null:i.userLogins.length)&&!i.isLoading),e.R7$(),e.Y8G("ngIf",(null==i.userLogins?null:i.userLogins.length)>0),e.R7$(),e.Y8G("ngIf",(null==i.userLogins?null:i.userLogins.length)>0),e.R7$(),e.Y8G("modalId","revokeLoginModal")("type","danger")("buttonType","danger")("title","UserLogins.RevokeExternalLogin")("okText","Common.Revoke"),e.R7$(4),e.SpI("",e.bMT(10,11,"UserLogins.RevokeLoginConfirmationText")," for "),e.R7$(3),e.JRh(null!==(a=null==i.selectedLogin?null:i.selectedLogin.providerDisplayName)&&void 0!==a?a:null==i.selectedLogin?null:i.selectedLogin.providerKey)}},dependencies:[d.Sq,d.bT,R.B,W.d,k.B,p.D9],styles:["[_nghost-%COMP%]{width:100%;display:block;position:relative}"]})}}return s})();var jt=l(4572),Dt=l(3519),St=l(7883),$t=l(4354);const wt=["RolePicker"],At=[{path:"",redirectTo:"details",pathMatch:"full"},{path:"details",component:Ct,canDeactivate:[E.M]},{path:"roles",component:(()=>{class s{constructor(t,n,i,a,r,m){this.rolesService=t,this.userService=n,this.titleService=i,this.translate=a,this.toastr=r,this.securityService=m,this.availableRoles=[],this.assignedRoles=[],this.restrictedPolicies=[],this.roleSearchValue=""}ngOnInit(){this.combinedObservable=(0,jt.z)([this.rolesService.getRoles(),this.userService.getCachedUser()]).pipe((0,T.$)()).subscribe(t=>{this.availableRoles=t[0],this.assignedRoles=t[1].roles,this.user=t[1],this.matchRoles();const n=this.translate.instant("Users.Singular")+" "+this.user.username+" "+this.translate.instant("Nav.Roles")+" - "+b.$9.SITE_TITLE;this.titleService.setTitle(n)})}ngAfterViewInit(){this.rolePicker.assignedStream.subscribe(t=>{this.addRoles(t)}),this.rolePicker.unAssignedStream.subscribe(t=>{this.deleteRoles(t)})}ngOnDestroy(){this.combinedObservable.unsubscribe()}isPolicyRole(t){const n=this.securityService.policyClaims;for(let i=0;i<n.length;i++)if("role"===n[i].type&&n[i].value===t)return!0;return!1}matchRoles(){for(const t of this.assignedRoles)for(const n of this.availableRoles)n.name===t.name&&this.availableRoles.splice(this.availableRoles.indexOf(n),1)}addRoles(t){const n=t.map(i=>i.name);this.userService.addUserRoles(this.user.subject,n).subscribe(i=>{this.availableRoles=(0,D.Yt)(this.availableRoles.slice(),t);const a=this.assignedRoles.slice();this.assignedRoles=a.concat(t),this.rolePicker.availableCount=0,this.user.roles=this.assignedRoles.slice(),this.userService.userSubject.next(this.user),this.toastr.success(this.translate.instant("Roles.Success"),this.translate.instant("Notifications.Success"))},i=>{401===i.status&&this.toastr.warning(this.translate.instant("Roles.AssignUnauthorized"),this.translate.instant("Notifications.Unauthorized"))})}deleteRoles(t){const n=t.map(i=>i.name);this.userService.deleteUserRoles(this.user.subject,n).subscribe(i=>{this.assignedRoles=(0,D.Yt)(this.assignedRoles.slice(),t);const a=this.availableRoles.slice();this.availableRoles=a.concat(t),this.rolePicker.assignedCount=0,this.user.roles=this.assignedRoles.slice(),this.userService.userSubject.next(this.user),this.toastr.success(this.translate.instant("Roles.Success"),this.translate.instant("Notifications.Success"))},i=>{401===i.status&&this.toastr.warning(this.translate.instant("Roles.UnassignUnauthorized"),this.translate.instant("Notifications.Unauthorized"))})}static{this.\u0275fac=function(n){return new(n||s)(e.rXU(Dt.P),e.rXU(g.D),e.rXU(C.hE),e.rXU(p.c$),e.rXU(v.tw),e.rXU(St.i))}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["app-user-roles"]],viewQuery:function(n,i){if(1&n&&e.GBs(wt,7),2&n){let a;e.mGM(a=e.lsd())&&(i.rolePicker=a.first)}},decls:3,vars:5,consts:[["RolePicker",""],["id","editUserRoles",1,"tw-container","tw-mx-auto"],[3,"assignedInput","availableInput","restrictedInput","assignedSearch","availableSearch"]],template:function(n,i){1&n&&(e.j41(0,"div",1),e.nrm(1,"app-common-picker",2,0),e.k0s()),2&n&&(e.R7$(),e.Y8G("assignedInput",i.assignedRoles)("availableInput",i.availableRoles)("restrictedInput",i.restrictedPolicies)("assignedSearch",!1)("availableSearch",!0))},dependencies:[$t.f],styles:["[_nghost-%COMP%]{width:100%;display:block;position:relative}"]})}}return s})()},{path:"additionaldetails",component:Oe,canDeactivate:[E.M]},{path:"applications",component:at},{path:"userlogins",component:kt},{path:"useraudits",component:te.L,canActivate:[K._,q.q]},{path:"sessions",component:G.Z,canActivate:[ee.O]}];let Mt=(()=>{class s{static{this.\u0275fac=function(n){return new(n||s)}}static{this.\u0275mod=e.$C({type:s})}static{this.\u0275inj=e.G2t({imports:[p.h.forChild({extend:!0}),h.iI.forChild(At),p.h,h.iI]})}}return s})();var Gt=l(1683),Et=l(4811),Nt=l(2571),Yt=l(5663),Vt=l(8389),Xt=l(5731),xt=l(7677),Bt=l(7175),Lt=l(367),Pt=l(8455),Jt=l(1993),Ot=l(4193),zt=l(9475),Wt=l(6599),Ht=l(3665),Qt=l(3730),Zt=l(4367);let Kt=(()=>{class s{static{this.\u0275fac=function(n){return new(n||s)}}static{this.\u0275mod=e.$C({type:s})}static{this.\u0275inj=e.G2t({providers:[Et.M,Yt.Q],imports:[Mt,d.MD,c.YN,c.X1,M.Q_,Gt.Y,p.h,Nt.A,Z.Ss,A.XE,zt.F,Lt.m,Xt.i,Ot.c,Ht.t,Bt.c,Vt.w,Wt.Y,h.iI,G.Z,Qt.ClaimTypesModule,xt.N,Pt.p,Jt.E,Zt.N,h.iI]})}}return s})()}}]);