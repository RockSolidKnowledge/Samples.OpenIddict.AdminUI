"use strict";(self.webpackChunkidentity_express_manager_ui=self.webpackChunkidentity_express_manager_ui||[]).push([[861],{2734:(A,S,a)=>{a.d(S,{x:()=>h});var u=a(1626),w=a(7263),j=a(4438);let h=(()=>{class g{buildParams(d,m,f,t,v,k,F,R){let l=new u.Nl;return l=this.addStringParam(l,"auditAction",d?.auditAction),l=this.addStringParam(l,"subject",d?.subject),l=this.addStringParam(l,"resource",d?.resourceName),l=this.addStringParam(l,"source",d?.source),l=this.addAnyParam(l,"success",F),l=this.addStringParam(l,"sort",k),l=this.addStringParam(l,"to",f),l=this.addStringParam(l,"from",m),l=this.addAnyParam(l,"page",t),l=this.addAnyParam(l,"pageSize",v),(0,w.hX)(R)||(l=this.addAnyParam(l,"bySubject",R)),l}addAnyParam(d,m,f){return(0,w.hX)(f)?d:d.append(m,String(f))}addStringParam(d,m,f){return(0,w.gP)(f)?d:d.append(m,f)}static{this.\u0275fac=function(m){return new(m||g)}}static{this.\u0275prov=j.jDH({token:g,factory:g.\u0275fac})}}return g})()},9861:(A,S,a)=>{a.d(S,{k:()=>_t});var u=a(9417),w=a(9172),j=a(1397),h=a(4549),g=a(1413),p=a(7263);class d{constructor(r,e,n,s){this.auditAction=r||"",this.subject=e||"",this.resourceName=n||"",this.source=s||""}}class m{constructor(r){this.auditAction=r.auditSearch.auditAction,this.subject=r.auditSearch.subject,this.resourceName=r.auditSearch.resourceName,this.source=r.auditSearch.source,this.fromDate=r.fromDate.toString(),this.toDate=r.toDate.toString(),this.page=r.page,this.pageSize=r.pageSize,this.sortCriteria=r.sortCriteria,this.success=r.success,this.bySubject=r.bySubject}}class f{constructor(r,e,n,s,o,c,_,b){this.auditSearch=r,this.fromDate=e,this.toDate=n,this.page=s,this.pageSize=o,this.sortCriteria=c,this.success=_,this.bySubject=b}}var t=a(4438),v=a(2734),k=a(7005),F=a(1583),R=a(7883),l=a(9686),T=a(1575),I=a(177),$=a(534),y=a(7156),D=a(7294),C=a(7384),E=a(6536),L=a(1780),G=a(1589);function x(i,r){1&i&&(t.j41(0,"span",65),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&i&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"Auditing.FromDateWarning")," "))}function N(i,r){1&i&&(t.j41(0,"span",66),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&i&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"Auditing.ToDateBehindWarning")," "))}function V(i,r){if(1&i){const e=t.RV6();t.j41(0,"div",10)(1,"p",53),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.j41(4,"ul",19)(5,"li")(6,"button",67),t.bIt("click",function(){t.eBV(e);const s=t.XpG();return t.Njj(s.setActorOrResource(!0))}),t.EFF(7),t.nI1(8,"translate"),t.k0s()(),t.j41(9,"li")(10,"button",68),t.bIt("click",function(){t.eBV(e);const s=t.XpG();return t.Njj(s.setActorOrResource(!1))}),t.EFF(11),t.nI1(12,"translate"),t.k0s()()()()}if(2&i){const e=t.XpG();t.R7$(2),t.JRh(t.bMT(3,7,"Auditing.ByFilter")),t.R7$(4),t.AVh("tw-btn-link",!e.getBySubjectFilterState),t.R7$(),t.SpI(" ",t.bMT(8,9,"Auditing.BySubject")," "),t.R7$(3),t.AVh("tw-btn-link",e.getBySubjectFilterState),t.R7$(),t.SpI(" ",t.bMT(12,11,"Auditing.ByResource")," ")}}function M(i,r){if(1&i){const e=t.RV6();t.j41(0,"li",72)(1,"button",73),t.bIt("click",function(){t.eBV(e);const s=t.XpG(2);return t.Njj(s.removeFilter("source"))}),t.j41(2,"b",74),t.EFF(3),t.nI1(4,"translate"),t.k0s(),t.j41(5,"span"),t.EFF(6),t.k0s(),t.nrm(7,"span",75),t.k0s()()}if(2&i){const e=t.XpG(2);t.R7$(3),t.SpI("",t.bMT(4,2,"Auditing.Source"),":"),t.R7$(3),t.JRh(e.filterForm.get("auditSearch").get("source").value)}}function B(i,r){if(1&i){const e=t.RV6();t.j41(0,"li",72)(1,"button",76),t.bIt("click",function(){t.eBV(e);const s=t.XpG(2);return t.Njj(s.removeFilter("subject"))}),t.j41(2,"b",74),t.EFF(3),t.nI1(4,"translate"),t.k0s(),t.j41(5,"span"),t.EFF(6),t.k0s(),t.nrm(7,"span",75),t.k0s()()}if(2&i){const e=t.XpG(2);t.R7$(3),t.SpI("",t.bMT(4,2,"Auditing.Subject"),":"),t.R7$(3),t.JRh(e.filterForm.get("auditSearch").get("subject").value)}}function O(i,r){if(1&i){const e=t.RV6();t.j41(0,"li",72)(1,"button",76),t.bIt("click",function(){t.eBV(e);const s=t.XpG(2);return t.Njj(s.removeFilter("auditAction"))}),t.j41(2,"b",74),t.EFF(3),t.nI1(4,"translate"),t.k0s(),t.j41(5,"span"),t.EFF(6),t.k0s(),t.nrm(7,"span",75),t.k0s()()}if(2&i){const e=t.XpG(2);t.R7$(3),t.SpI("",t.bMT(4,2,"Auditing.Action"),":"),t.R7$(3),t.JRh(e.filterForm.get("auditSearch").get("auditAction").value)}}function Y(i,r){if(1&i){const e=t.RV6();t.j41(0,"li",72)(1,"button",76),t.bIt("click",function(){t.eBV(e);const s=t.XpG(2);return t.Njj(s.removeFilter("resourceName"))}),t.j41(2,"b",74),t.EFF(3),t.nI1(4,"translate"),t.k0s(),t.j41(5,"span"),t.EFF(6),t.k0s(),t.nrm(7,"span",75),t.k0s()()}if(2&i){const e=t.XpG(2);t.R7$(3),t.SpI("",t.bMT(4,2,"Auditing.Resource"),":"),t.R7$(3),t.JRh(e.filterForm.get("auditSearch").get("resourceName").value)}}function X(i,r){if(1&i&&(t.j41(0,"div",69)(1,"p",51),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.j41(4,"ul",70),t.DNE(5,M,8,4,"li",71)(6,B,8,4,"li",71)(7,O,8,4,"li",71)(8,Y,8,4,"li",71),t.k0s()()),2&i){const e=t.XpG();t.R7$(2),t.JRh(t.bMT(3,5,"Auditing.ActiveFilters")),t.R7$(3),t.Y8G("ngIf",e.filterForm.get("auditSearch").get("source").value),t.R7$(),t.Y8G("ngIf",e.filterForm.get("auditSearch").get("subject").value),t.R7$(),t.Y8G("ngIf",e.filterForm.get("auditSearch").get("auditAction").value),t.R7$(),t.Y8G("ngIf",e.filterForm.get("auditSearch").get("resourceName").value)}}function P(i,r){1&i&&(t.j41(0,"span"),t.nrm(1,"span",77),t.EFF(2),t.nI1(3,"translate"),t.k0s()),2&i&&(t.R7$(2),t.SpI(" ",t.bMT(3,1,"Auditing.ShowFilters")," "))}function z(i,r){1&i&&(t.j41(0,"span"),t.nrm(1,"span",78),t.EFF(2),t.nI1(3,"translate"),t.k0s()),2&i&&(t.R7$(2),t.SpI(" ",t.bMT(3,1,"Auditing.HideFilters")," "))}function J(i,r){1&i&&(t.j41(0,"option",79),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&i&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"Auditing.Subject"),""))}function U(i,r){1&i&&(t.j41(0,"option",80),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&i&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"Auditing.Resource"),""))}function H(i,r){1&i&&(t.j41(0,"p",81),t.nrm(1,"span",82),t.EFF(2),t.nI1(3,"translate"),t.k0s()),2&i&&(t.R7$(2),t.SpI(" ",t.bMT(3,1,"Auditing.UpdateWarning")," "))}function W(i,r){1&i&&(t.j41(0,"span",87)(1,"span",51),t.EFF(2),t.nI1(3,"translate"),t.k0s()()),2&i&&(t.R7$(2),t.JRh(t.bMT(3,1,"Common.Loading")))}function Q(i,r){if(1&i){const e=t.RV6();t.j41(0,"app-action-bar"),t.qex(1,83),t.DNE(2,W,4,3,"span",84),t.j41(3,"button",85),t.nI1(4,"translate"),t.bIt("click",function(){t.eBV(e);const s=t.XpG();return t.Njj(s.getCSV())}),t.j41(5,"span"),t.nrm(6,"span",86),t.k0s(),t.j41(7,"span",51),t.EFF(8),t.nI1(9,"translate"),t.k0s()(),t.bVm(),t.k0s()}if(2&i){const e=t.XpG();t.R7$(2),t.Y8G("ngIf",e.loadingCSV),t.R7$(),t.Y8G("tooltip",t.bMT(4,4,"Auditing.DownloadResults"))("disabled",(null==e.pagedResult?null:e.pagedResult.results.length)<1&&!e.isLoading||e.loadingCSV),t.R7$(5),t.JRh(t.bMT(9,6,"Auditing.DownloadResults"))}}function K(i,r){1&i&&t.nrm(0,"app-simple-loader")}function Z(i,r){1&i&&(t.j41(0,"div",88)(1,"div"),t.EFF(2),t.nI1(3,"translate"),t.k0s()()),2&i&&(t.R7$(2),t.JRh(t.bMT(3,1,"Auditing.NoAuditsFound")))}function q(i,r){1&i&&(t.j41(0,"th",101),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&i&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"Auditing.Subject")," "))}function tt(i,r){1&i&&(t.j41(0,"th",102),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&i&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"Auditing.Resource")," "))}function et(i,r){if(1&i&&(t.j41(0,"span"),t.EFF(1),t.k0s()),2&i){const e=t.XpG(2).$implicit;t.R7$(),t.JRh(e.subject.name)}}function it(i,r){if(1&i){const e=t.RV6();t.j41(0,"span")(1,"a",115),t.bIt("click",function(){t.eBV(e);const s=t.XpG(2).$implicit,o=t.XpG(2);return t.Njj(!!o.resourceNavigate(s.subject))}),t.EFF(2),t.k0s()()}if(2&i){const e=t.XpG(2).$implicit,n=t.XpG(2);t.R7$(),t.FS9("href",n.buildLink(e.subject),t.B4B),t.R7$(),t.SpI(" ",e.subject.name," ")}}function st(i,r){if(1&i&&(t.j41(0,"td",114),t.DNE(1,et,2,1,"span",35)(2,it,3,2,"span",35),t.k0s()),2&i){const e=t.XpG().$implicit,n=t.XpG(2);t.R7$(),t.Y8G("ngIf",""==n.buildLink(e.subject)),t.R7$(),t.Y8G("ngIf",""!=n.buildLink(e.subject))}}function nt(i,r){if(1&i&&(t.j41(0,"span"),t.EFF(1),t.k0s()),2&i){const e=t.XpG(2).$implicit;t.R7$(),t.SpI(" ",e.resource.name," ")}}function rt(i,r){if(1&i&&(t.j41(0,"span"),t.EFF(1),t.k0s()),2&i){const e=t.XpG(3).$implicit;t.R7$(),t.JRh(e.resource.identifier)}}function at(i,r){if(1&i&&(t.j41(0,"span"),t.EFF(1),t.k0s()),2&i){const e=t.XpG(3).$implicit;t.R7$(),t.JRh(e.resource.name)}}function ot(i,r){if(1&i){const e=t.RV6();t.j41(0,"span")(1,"a",115),t.bIt("click",function(){t.eBV(e);const s=t.XpG(2).$implicit,o=t.XpG(2);return t.Njj(!!o.resourceNavigate(s.resource))}),t.DNE(2,rt,2,1,"span",35)(3,at,2,1,"span",35),t.k0s()()}if(2&i){const e=t.XpG(2).$implicit,n=t.XpG(2);t.R7$(),t.FS9("href",n.buildLink(e.resource),t.B4B),t.R7$(),t.Y8G("ngIf",""==e.name),t.R7$(),t.Y8G("ngIf",""!=e.name)}}function lt(i,r){if(1&i&&(t.j41(0,"td",116),t.DNE(1,nt,2,1,"span",35)(2,ot,4,3,"span",35),t.k0s()),2&i){const e=t.XpG().$implicit,n=t.XpG(2);t.R7$(),t.Y8G("ngIf","*"==e.resource.name||""==n.buildLink(e.resource)),t.R7$(),t.Y8G("ngIf","*"!=e.resource.name&&""!=n.buildLink(e.resource))}}function ct(i,r){1&i&&(t.j41(0,"span",117)(1,"span",51),t.EFF(2),t.nI1(3,"translate"),t.k0s()()),2&i&&(t.R7$(2),t.JRh(t.bMT(3,1,"Common.Yes")))}function ut(i,r){1&i&&(t.j41(0,"span",118)(1,"span",51),t.EFF(2),t.nI1(3,"translate"),t.k0s()()),2&i&&(t.R7$(2),t.JRh(t.bMT(3,1,"Common.No")))}function dt(i,r){1&i&&t.nrm(0,"span",125)}function pt(i,r){1&i&&t.nrm(0,"span",126)}function mt(i,r){if(1&i&&(t.j41(0,"tr",119),t.nrm(1,"td"),t.j41(2,"td",120)(3,"div",121)(4,"span",122),t.DNE(5,dt,1,0,"span",123)(6,pt,1,0,"span",124),t.k0s(),t.j41(7,"span"),t.EFF(8),t.k0s()()()()),2&i){const e=t.XpG().$implicit;t.R7$(5),t.Y8G("ngIf",e.succeeded),t.R7$(),t.Y8G("ngIf",!e.succeeded),t.R7$(2),t.JRh(e.description)}}function ft(i,r){if(1&i){const e=t.RV6();t.qex(0,null,4),t.j41(2,"tr")(3,"td",103)(4,"button",104),t.bIt("click",function(){t.eBV(e);const s=t.sdS(1);return t.Njj(s.isOpen=!s.isOpen)}),t.nrm(5,"span",105),t.j41(6,"span",51),t.EFF(7),t.nI1(8,"translate"),t.k0s()()(),t.j41(9,"td"),t.EFF(10),t.nI1(11,"standardDateTime"),t.nrm(12,"div"),t.k0s(),t.j41(13,"td",106),t.EFF(14),t.k0s(),t.DNE(15,st,3,2,"td",107)(16,lt,3,2,"td",108),t.j41(17,"td",109),t.EFF(18),t.k0s(),t.j41(19,"td",110),t.DNE(20,ct,4,3,"span",111)(21,ut,4,3,"span",112),t.k0s()(),t.DNE(22,mt,9,3,"tr",113),t.bVm()}if(2&i){const e=r.$implicit,n=t.sdS(1),s=t.XpG(2);t.R7$(5),t.AVh("fa-caret-right",!n.isOpen),t.R7$(2),t.SpI(" ",t.bMT(8,11,"Auditing.ToggleDetails")," "),t.R7$(3),t.SpI(" ",t.bMT(11,13,e.when)," "),t.R7$(4),t.SpI(" ",e.source," "),t.R7$(),t.Y8G("ngIf",!s.resourceBySubject),t.R7$(),t.Y8G("ngIf",!s.resourceByResource),t.R7$(2),t.SpI(" ",e.action," "),t.R7$(2),t.Y8G("ngIf",e.succeeded),t.R7$(),t.Y8G("ngIf",!e.succeeded),t.R7$(),t.Y8G("ngIf",n.isOpen)}}function ht(i,r){if(1&i){const e=t.RV6();t.j41(0,"table",89)(1,"thead")(2,"tr")(3,"th",90)(4,"span",51),t.EFF(5),t.nI1(6,"translate"),t.k0s()(),t.j41(7,"th",91),t.bIt("click",function(){t.eBV(e);const s=t.XpG();return t.Njj(s.sortResults())}),t.j41(8,"span",92),t.EFF(9),t.nI1(10,"translate"),t.k0s(),t.nrm(11,"span",93),t.k0s(),t.j41(12,"th",94),t.EFF(13),t.nI1(14,"translate"),t.k0s(),t.DNE(15,q,3,3,"th",95)(16,tt,3,3,"th",96),t.j41(17,"th",97),t.EFF(18),t.nI1(19,"translate"),t.k0s(),t.j41(20,"th",98),t.EFF(21),t.nI1(22,"translate"),t.k0s()()(),t.j41(23,"tbody",99),t.DNE(24,ft,23,15,"ng-container",100),t.k0s()()}if(2&i){const e=t.XpG();t.R7$(5),t.JRh(t.bMT(6,10,"Common.Actions")),t.R7$(4),t.JRh(t.bMT(10,12,"Auditing.When")),t.R7$(2),t.AVh("fa-caret-up","when"==e.filterSort),t.R7$(2),t.JRh(t.bMT(14,14,"Auditing.Source")),t.R7$(2),t.Y8G("ngIf",!e.resourceBySubject),t.R7$(),t.Y8G("ngIf",!e.resourceByResource),t.R7$(2),t.JRh(t.bMT(19,16,"Auditing.Action")),t.R7$(3),t.SpI(" ",t.bMT(22,18,"Notifications.Success")," "),t.R7$(3),t.Y8G("ngForOf",e.pagedResult.results)}}function gt(i,r){if(1&i){const e=t.RV6();t.j41(0,"app-pager",127),t.bIt("onGoToPage",function(s){t.eBV(e);const o=t.XpG();return t.Njj(o.goToPage(s))}),t.k0s()}if(2&i){const e=t.XpG();t.Y8G("totalResults",null==e.pagedResult?null:e.pagedResult.totalCount)("currentPage",e.filterForm.get("page").value)("lastPage",null==e.pagedResult?null:e.pagedResult.pageCount)}}let _t=(()=>{class i{get getBySubjectFilterState(){return JSON.parse(this.filterForm.value.bySubject)}get resourceOnly(){return!(0,p.gP)(this.resourceName)}get resourceBySubject(){return this.resourceOnly&&this.getBySubjectFilterState}get resourceByResource(){return this.resourceOnly&&!this.getBySubjectFilterState}constructor(e,n,s,o,c,_,b,bt){this.auditingService=e,this.localizeRouter=n,this.router=s,this.fb=o,this.activatedRoute=c,this.securityService=_,this.fileDownloader=b,this.timeService=bt,this.sortAsc="when",this.sortDesc="-when",this.isLoading=!1,this.loadingCSV=!1,this.showAddFilter=!1,this.filterHasChanged=!1,this.auditStream=new g.B}userManagerReadOnly(){return(0,p.zG)(this.securityService.userPermissions)}identityServerManagerReadOnly(){return(0,p.ci)(this.securityService.userPermissions)}ngOnInit(){this.setupFilterForm(this.activatedRoute.snapshot.queryParams),this.auditStream.pipe((0,w.Z)({auditSearch:this.filterForm.value.auditSearch,toDate:this.filterForm.value.toDate,fromDate:this.filterForm.value.fromDate,page:this.filterForm.value.page,pageSize:this.filterForm.value.pageSize,sortCriteria:this.filterForm.value.sortCriteria,success:this.filterForm.value.success,bySubject:this.filterForm.value.bySubject}),(0,j.Z)(n=>(this.isLoading=!0,this.resourceOnly?this.auditingService.getResourceAudits(this.resourceName,n.bySubject,n.auditSearch,n.toDate.toString(),n.fromDate.toString(),n.page,n.pageSize,n.sortCriteria,n.success):this.auditingService.getAudits(n.auditSearch,n.toDate.toString(),n.fromDate.toString(),n.page,n.pageSize,n.sortCriteria,n.success)))).subscribe(n=>{this.isLoading=!1,this.pagedResult=n;const s=new m(this.filterForm.value);this.router.navigate([this.router.url.split("?")[0]],{queryParams:s}),this.aplliedBySubjectFilter=JSON.parse(this.filterForm.value.bySubject)})}applyForm(e){e&&this.filterForm.patchValue({page:1}),this.auditStream.next(this.filterForm.value),this.filterHasChanged=!1}goToPage(e){this.filterForm.patchValue({page:e}),this.applyForm(!1)}setDateToday(){this.filterForm.patchValue({fromDate:this.timeService.now().startOf("day"),toDate:this.timeService.now().endOf("day")})}setDateLast24Hours(){this.filterForm.patchValue({fromDate:this.timeService.now().minus({hours:24}),toDate:this.timeService.now()})}setDateYesterday(){this.filterForm.patchValue({fromDate:this.timeService.now().startOf("day").minus({hours:24}),toDate:this.timeService.now().endOf("day").minus({hours:24})})}setDateLastWeek(){this.filterForm.patchValue({fromDate:this.timeService.now().minus({weeks:1}).startOf("day"),toDate:this.timeService.now().endOf("day")})}goToResource(e){this.router.config.find(s=>void 0!==s.children)}auditSearch(e,n){this.filterForm.patchValue({auditSearch:{[e]:n.value}})}selectFilterType(e,n){const s=this.filterForm.get("auditSearch").get(e).value;n.value=s}removeFilter(e){this.filterForm.patchValue({auditSearch:{[e]:""}})}checkQuickDate(e){switch(e){case"today":return this.stripSecondsFromString(this.filterForm.get("fromDate").value)===this.stripSecondsFromDateTime(this.timeService.now().startOf("day"))&&this.stripSecondsFromString(this.filterForm.get("toDate").value)===this.stripSecondsFromDateTime(this.timeService.now().endOf("day"));case"24hours":return this.stripSecondsFromString(this.filterForm.get("fromDate").value)===this.stripSecondsFromDateTime(this.timeService.now().minus({hours:24}))&&this.stripSecondsFromString(this.filterForm.get("toDate").value)===this.stripSecondsFromDateTime(this.timeService.now());case"yesterday":return this.stripSecondsFromString(this.filterForm.get("fromDate").value)===this.stripSecondsFromDateTime(this.timeService.now().startOf("day").minus({hours:24}))&&this.stripSecondsFromString(this.filterForm.get("toDate").value)===this.stripSecondsFromDateTime(this.timeService.now().endOf("day").minus({hours:24}));case"week":return this.stripSecondsFromString(this.filterForm.get("fromDate").value)===this.stripSecondsFromDateTime(this.timeService.now().minus({weeks:1}).startOf("day"))&&this.stripSecondsFromString(this.filterForm.get("toDate").value)===this.stripSecondsFromDateTime(this.timeService.now().endOf("day"))}}stripSecondsFromString(e){return this.stripSecondsFromDateTime(h.c9.fromISO(e))}stripSecondsFromDateTime(e){return e.set({second:0,millisecond:0}).toString()}setActorOrResource(e){this.filterForm.patchValue({bySubject:e})}setShowing(e,n){this.successfulFilter=e,this.unsuccessfulFilter=n,this.filter()}showActiveFilters(){const e=this.filterForm.get("auditSearch");return!!(e.get("source").value||e.get("subject").value||e.get("auditAction").value||e.get("resourceName").value)}filter(){this.filterForm.patchValue({success:this.successfulFilter&&this.unsuccessfulFilter||!this.successfulFilter&&!this.unsuccessfulFilter?null:this.successfulFilter})}getCSV(){this.fileDownloader.buildForm(this.buildActionUrl()).submitForm()}buildActionUrl(){let e=`${this.auditingService.actionUrl}`;const n=this.activatedRoute.snapshot.queryParams;return this.resourceOnly&&(e+=`/${this.resourceName}/auditedEvents`),e+=`?sort=${n.sortCriteria}`,(0,p.gP)(n.auditAction)||(e+=`&auditAction=${n.auditAction}`),(0,p.gP)(n.subject)||(e+=`&subject=${n.subject}`),(0,p.gP)(n.resourceName)||(e+=`&resource=${n.resourceName}`),(0,p.gP)(n.source)||(e+=`&source=${n.source}`),null!=n.success&&(e+=`&success=${n.success}`),null!=n.toDate&&(e+=`&to=${n.toDate}`),null!=n.fromDate&&(e+=`&from=${n.fromDate}`),(0,p.hX)(n.bySubject)||(e+=`&bySubject=${n.bySubject}`),e}sortResults(){const e=this.activatedRoute.snapshot.queryParams,n=new d(e.auditAction,e.subject,e.resourceName,e.source),s=void 0===e.fromDate?this.timeService.now().startOf("day"):h.c9.fromISO(e.fromDate),o=void 0===e.toDate?this.timeService.now().startOf("day"):h.c9.fromISO(e.toDate);this.filterSort=this.filterSort===this.sortAsc?this.sortDesc:this.sortAsc;const c=new f(n,s,o,e.page,e.pageSize,this.filterSort,e.success,e.bySubject);this.auditStream.next(c),this.filterHasChanged=!1}resetForm(){this.filterForm.setValue({fromDate:this.timeService.now().startOf("day"),toDate:this.timeService.now(),auditSearch:{auditAction:"",resourceName:"",subject:"",source:""},page:1,pageSize:25,sortCriteria:this.sortDesc,success:null}),this.filterHasChanged=!1,this.successfulFilter=!1,this.unsuccessfulFilter=!1,this.applyForm(!0)}setupFilterForm(e){const n=void 0===e.fromDate?this.timeService.now().startOf("day"):h.c9.fromISO(e.fromDate),s=void 0===e.toDate?this.timeService.now().endOf("day"):h.c9.fromISO(e.toDate);this.filterForm=this.fb.nonNullable.group({fromDate:[n,[u.k0.required,p.TO]],toDate:[s],auditSearch:this.fb.group({auditAction:[e.auditAction||""],resourceName:[e.resourceName||""],subject:[e.subject||""],source:[e.source||""]}),page:[e.page||1],pageSize:[e.pageSize>1e3?1e3:e.pageSize||25],sortCriteria:[e.sortCriteria||this.sortDesc],success:[e.success||null],bySubject:[e.bySubject??!0]},{validators:p.$N}),this.filterSort=this.filterForm.value.sortCriteria,this.filterForm.valueChanges.subscribe(()=>{this.filterHasChanged=!0})}Navigate(e,n){this.router.navigate([e,n])}resourceNavigate(e){const n=this.buildTranslatedRoute(e);"*"!==e.name&&this.Navigate(n,e.identifier)}buildLink(e){let n=this.buildTranslatedRoute(e);return n+=`/${e.identifier}`,n}buildTranslatedRoute(e){switch(e.type){case"User":return this.userManagerReadOnly()?`${this.localizeRouter.translateRoute("/users/view")}`:`${this.localizeRouter.translateRoute("/users")}`;case"Client":case"Machine":return this.identityServerManagerReadOnly()?`${this.localizeRouter.translateRoute("/clients/view")}`:`${this.localizeRouter.translateRoute("/clients")}`;case"IdentityResource":return this.identityServerManagerReadOnly()?`${this.localizeRouter.translateRoute("/identityresources/view")}`:`${this.localizeRouter.translateRoute("/identityresources")}`;case"ProtectedResource":return this.identityServerManagerReadOnly()?`${this.localizeRouter.translateRoute("/protectedresources/view")}`:`${this.localizeRouter.translateRoute("/protectedresources")}`;case"ClaimType":return this.userManagerReadOnly()?`${this.localizeRouter.translateRoute("/claim-types/view")}`:`${this.localizeRouter.translateRoute("/claim-types")}`;case"Role":return this.userManagerReadOnly()?`${this.localizeRouter.translateRoute("/roles/view")}`:`${this.localizeRouter.translateRoute("/roles")}`;default:return""}}static{this.\u0275fac=function(n){return new(n||i)(t.rXU(v.x),t.rXU(k.QG),t.rXU(F.Ix),t.rXU(u.ok),t.rXU(F.nX),t.rXU(R.i),t.rXU(l.D),t.rXU(T.v))}}static{this.\u0275cmp=t.VBU({type:i,selectors:[["app-audits-list"]],inputs:{resourceName:"resourceName"},decls:131,vars:105,consts:[["pageLength",""],["filterType",""],["filterValue",""],["sortCriteria",""],["group",""],["id","auditingList"],[1,"",3,"formGroup"],[1,"tw-border-b","tw-border-grey-200","tw-mb-4","tw-pb-5"],[1,"tw-flex-grid","tw-mb-3","lg:tw-flex-nowrap"],[1,"tw-flex-grid-col","xs:tw-w-1/2","lg:tw-w-1/3"],[1,"tw-form-group","tw-mb-0"],["for","fromDate",1,"tw-form-label"],["id","fromDate","name","fromDate","formControlName","fromDate","aria-describedby","toErrorLabel",3,"displayType"],["id","fromErrorLabel","class","tw-form-text-danger",4,"ngIf"],["for","toDate",1,"tw-form-label"],["id","toDate","name","toDate","formControlName","toDate","aria-describedby","toErrorLabel",3,"displayType"],["id","toErrorLabel","class","tw-form-text-danger",4,"ngIf"],[1,"tw-hidden","tw-flex-grid-col","xs:tw-block","sm:tw-w-auto","sm:tw-mr-auto"],["aria-hidden","true",1,"tw-hidden","tw-form-label","tw-invisible","sm:tw-inline-block"],[1,"tw-flex","tw-items-center"],["name","setToday","id","setToday",1,"tw-btn",3,"click"],["name","set24hrs","id","set24hrs",1,"tw-btn",3,"click"],["name","setYesterday","id","setYesterday",1,"tw-btn",3,"click"],["name","setLastWeek","id","setLastWeek",1,"tw-btn",3,"click"],[1,"tw-flex-grid-col","tw-ml-0"],["class","tw-form-group tw-mb-0",4,"ngIf"],[1,"tw-flex-grid-col","tw-w-40","tw-ml-0"],["for","pageSize",1,"tw-form-label"],[1,"tw-form-select"],["id","pageSize","formControlName","pageSize",1,"tw-form-control"],[3,"value"],["formGroupName","auditSearch"],["class","tw-my-4",4,"ngIf"],[1,"tw-mb-4"],["id","showFilterButton","type","button","aria-expanded","showAddFilter",1,"tw-btn-link","tw-btn-small","tw-px-0",3,"click"],[4,"ngIf"],["id","toggleFilters","aria-labelledby","showFilterButton",1,"tw-mt-3","tw-mb-6",3,"hidden"],[1,"tw-flex-grid","md:tw-flex-nowrap"],[1,"tw-flex-grid-col","md:tw-w-2/3","lg:tw-w-3/5"],["for","filterType",1,"tw-form-label"],[1,"tw-flex-grid"],[1,"tw-flex-grid-col","xs:tw-w-2/5","sm:tw-w-1/3"],["id","filterType","name","filterType",1,"tw-form-control",3,"change"],["value","source"],["value","subject",4,"ngIf"],["value","auditAction"],["value","resourceName",4,"ngIf"],[1,"tw-flex-grid-col","tw-flex","xs:tw-w-3/5","sm:tw-w-2/3"],["id","filterTerm","type","text","autocomplete","off",1,"tw-form-control","tw-border-r-0","tw-rounded-r-none"],["type","submit",1,"tw-btn","tw-rounded-l-none",3,"click"],["aria-hidden","true",1,"far","fa-plus"],[1,"sr-only"],[1,"tw-flex-grid-col","md:tw-ml-auto","md:tw-w-auto"],[1,"tw-form-label"],["id","allFilter",1,"tw-btn",3,"click"],["id","activeFilter",1,"tw-btn",3,"click"],["id","blockedFilter",1,"tw-btn",3,"click"],[1,"tw-flex","tw-flex-wrap","tw-items-center"],["type","hidden"],["id","applyBtn",1,"tw-btn-success","tw-mr-3",3,"click","disabled"],[1,"tw-btn-link","tw-mr-3",3,"click"],["class","tw-pill-warning tw-my-2",4,"ngIf"],["class","tw-alert","role","alert",4,"ngIf"],["class","datatable hover",4,"ngIf"],[3,"totalResults","currentPage","lastPage","onGoToPage",4,"ngIf"],["id","fromErrorLabel",1,"tw-form-text-danger"],["id","toErrorLabel",1,"tw-form-text-danger"],["id","bySubjectFilter",1,"tw-btn",3,"click"],["id","byResourceFilter",1,"tw-btn",3,"click"],[1,"tw-my-4"],[1,"tw-flex","tw-flex-wrap","tw-items-start","tw--mt-2","tw--ml-2"],["class","tw-pt-2 tw-pl-2",4,"ngIf"],[1,"tw-pt-2","tw-pl-2"],["id","sourceSearchValue",1,"tw-btn-danger","tw-btn-small",3,"click"],[1,"tw-font-bold","tw-mr-1"],["aria-hidden","true",1,"fas","fa-times","tw-ml-3"],[1,"tw-btn-danger","tw-btn-small",3,"click"],["aria-hidden","true",1,"fas","fa-angle-down","tw-mr-1"],["aria-hidden","true",1,"fas","fa-angle-up","tw-mr-1"],["value","subject"],["value","resourceName"],[1,"tw-pill-warning","tw-my-2"],["aria-hidden","true",1,"fas","fa-info-circle","tw-mr-1"],["right",""],["class","fad fa-spinner-third fa-spin tw-text-xs tw-text-grey-700 tw-mr-3",4,"ngIf"],["id","getCSVBtn","container","body",1,"tw-btn-white",3,"click","tooltip","disabled"],["aria-hidden","true",1,"fad","fa-arrow-to-bottom"],[1,"fad","fa-spinner-third","fa-spin","tw-text-xs","tw-text-grey-700","tw-mr-3"],["role","alert",1,"tw-alert"],[1,"datatable","hover"],[1,"toggle","tw-w-1"],["id","sortWhen",1,"tw-cursor-pointer","xs:tw-w-40",3,"click"],[1,"tw-mr-2"],["aria-hidden","true",1,"fas","fa-caret-down"],[1,"tw-hidden","tw-w-32","md:tw-table-cell","xl:tw-w-40"],["class","tw-hidden xs:tw-table-cell lg:tw-w-1/4",4,"ngIf"],["id","ResourceHeading","class","tw-hidden lg:tw-table-cell",4,"ngIf"],[1,"tw-hidden","xl:tw-table-cell"],[1,"tw-hidden","tw-w-1","tw-text-center","sm:tw-table-cell"],["id","auditsTable"],[4,"ngFor","ngForOf"],[1,"tw-hidden","xs:tw-table-cell","lg:tw-w-1/4"],["id","ResourceHeading",1,"tw-hidden","lg:tw-table-cell"],[1,"toggle"],[1,"tw-btn-link","tw-btn-small",3,"click"],["aria-hidden","true",1,"fas","fa-caret-down","fa-fw"],[1,"tw-hidden","tw-max-w-0","tw-truncate","md:tw-table-cell"],["class","tw-hidden tw-max-w-0 tw-truncate xs:tw-table-cell subject",4,"ngIf"],["class","tw-hidden tw-max-w-0 tw-truncate lg:tw-table-cell resource",4,"ngIf"],[1,"tw-hidden","tw-max-w-0","tw-truncate","xl:tw-table-cell"],[1,"tw-hidden","tw-text-center","sm:tw-table-cell"],["class","fas fa-check tw-text-green-500",4,"ngIf"],["class","fas fa-times tw-text-red-500 tw-opacity-50",4,"ngIf"],["class","disabled toggle-row",4,"ngIf"],[1,"tw-hidden","tw-max-w-0","tw-truncate","xs:tw-table-cell","subject"],[3,"click","href"],[1,"tw-hidden","tw-max-w-0","tw-truncate","lg:tw-table-cell","resource"],[1,"fas","fa-check","tw-text-green-500"],[1,"fas","fa-times","tw-text-red-500","tw-opacity-50"],[1,"disabled","toggle-row"],["colspan","6",1,"tw-text-grey-800"],[1,"tw-flex","tw-items-start"],["aria-hidden","true",1,"tw-shrink-0","tw-mr-1"],["class","fas fa-check tw-text-green-500 fa-fw",4,"ngIf"],["class","fas fa-times tw-text-red-500 fa-fw",4,"ngIf"],[1,"fas","fa-check","tw-text-green-500","fa-fw"],[1,"fas","fa-times","tw-text-red-500","fa-fw"],[3,"onGoToPage","totalResults","currentPage","lastPage"]],template:function(n,s){if(1&n){const o=t.RV6();t.j41(0,"div",5)(1,"form",6)(2,"div",7)(3,"div",8)(4,"div",9)(5,"div",10)(6,"label",11),t.EFF(7),t.nI1(8,"translate"),t.k0s(),t.j41(9,"div"),t.nrm(10,"app-date-time",12),t.DNE(11,x,3,3,"span",13),t.k0s()()(),t.j41(12,"div",9)(13,"div",10)(14,"label",14),t.EFF(15),t.nI1(16,"translate"),t.k0s(),t.j41(17,"div"),t.nrm(18,"app-date-time",15),t.DNE(19,N,3,3,"span",16),t.k0s()()(),t.j41(20,"div",17)(21,"div",10)(22,"label",18),t.EFF(23,"\xa0"),t.k0s(),t.j41(24,"ul",19)(25,"li")(26,"button",20),t.nI1(27,"translate"),t.bIt("click",function(){return t.eBV(o),t.Njj(s.setDateToday())}),t.EFF(28),t.nI1(29,"translate"),t.k0s()(),t.j41(30,"li")(31,"button",21),t.nI1(32,"translate"),t.bIt("click",function(){return t.eBV(o),t.Njj(s.setDateLast24Hours())}),t.EFF(33),t.nI1(34,"translate"),t.k0s()(),t.j41(35,"li")(36,"button",22),t.nI1(37,"translate"),t.bIt("click",function(){return t.eBV(o),t.Njj(s.setDateYesterday())}),t.EFF(38),t.nI1(39,"translate"),t.k0s()(),t.j41(40,"li")(41,"button",23),t.nI1(42,"translate"),t.bIt("click",function(){return t.eBV(o),t.Njj(s.setDateLastWeek())}),t.EFF(43),t.nI1(44,"translate"),t.k0s()()()()()(),t.j41(45,"div",8)(46,"div",24),t.DNE(47,V,13,13,"div",25),t.k0s(),t.j41(48,"div",26)(49,"div",10)(50,"label",27),t.EFF(51),t.nI1(52,"translate"),t.k0s(),t.j41(53,"div",28)(54,"select",29,0)(56,"option",30),t.EFF(57,"25 "),t.k0s(),t.j41(58,"option",30),t.EFF(59,"50"),t.k0s(),t.j41(60,"option",30),t.EFF(61,"100"),t.k0s()()()()()(),t.j41(62,"form",31),t.DNE(63,X,9,7,"div",32),t.j41(64,"div",33)(65,"button",34),t.bIt("click",function(){return t.eBV(o),t.Njj(s.showAddFilter=!s.showAddFilter)}),t.DNE(66,P,4,3,"span",35)(67,z,4,3,"span",35),t.k0s(),t.j41(68,"div",36)(69,"div",37)(70,"div",38)(71,"div",10)(72,"label",39),t.EFF(73),t.nI1(74,"translate"),t.k0s(),t.j41(75,"div",40)(76,"div",41)(77,"div",28)(78,"select",42,1),t.bIt("change",function(){t.eBV(o);const _=t.sdS(79),b=t.sdS(90);return t.Njj(s.selectFilterType(_.value,b))}),t.j41(80,"option",43),t.EFF(81),t.nI1(82,"translate"),t.k0s(),t.DNE(83,J,3,3,"option",44),t.j41(84,"option",45),t.EFF(85),t.nI1(86,"translate"),t.k0s(),t.DNE(87,U,3,3,"option",46),t.k0s()()(),t.j41(88,"div",47),t.nrm(89,"input",48,2),t.nI1(91,"translate"),t.nI1(92,"translate"),t.j41(93,"button",49),t.bIt("click",function(){t.eBV(o);const _=t.sdS(79),b=t.sdS(90);return t.Njj(s.auditSearch(_.value,b))}),t.nrm(94,"span",50),t.j41(95,"span",51),t.EFF(96),t.nI1(97,"translate"),t.k0s()()()()()(),t.j41(98,"div",52)(99,"div",10)(100,"p",53),t.EFF(101),t.nI1(102,"translate"),t.k0s(),t.j41(103,"ul",19)(104,"li")(105,"button",54),t.bIt("click",function(){return t.eBV(o),t.Njj(s.setShowing(!1,!1))}),t.EFF(106),t.nI1(107,"translate"),t.k0s()(),t.j41(108,"li")(109,"button",55),t.bIt("click",function(){return t.eBV(o),t.Njj(s.setShowing(!0,!1))}),t.EFF(110),t.nI1(111,"translate"),t.k0s()(),t.j41(112,"li")(113,"button",56),t.bIt("click",function(){return t.eBV(o),t.Njj(s.setShowing(!1,!0))}),t.EFF(114),t.nI1(115,"translate"),t.k0s()()()()()()()(),t.j41(116,"div",57),t.nrm(117,"input",58,3),t.j41(119,"button",59),t.bIt("click",function(){return t.eBV(o),t.Njj(s.applyForm(!0))}),t.EFF(120),t.nI1(121,"translate"),t.k0s(),t.j41(122,"button",60),t.bIt("click",function(){return t.eBV(o),t.Njj(s.resetForm())}),t.EFF(123),t.nI1(124,"translate"),t.k0s(),t.DNE(125,H,4,3,"p",61),t.k0s()()()(),t.DNE(126,Q,10,8,"app-action-bar",35)(127,K,1,0,"app-simple-loader",35)(128,Z,4,3,"div",62)(129,ht,25,20,"table",63)(130,gt,1,3,"app-pager",64),t.k0s()}if(2&n){let o;t.R7$(),t.Y8G("formGroup",s.filterForm),t.R7$(6),t.JRh(t.bMT(8,59,"Auditing.FromDate")),t.R7$(3),t.Y8G("displayType","datetime"),t.R7$(),t.Y8G("ngIf",s.filterForm.get("fromDate").hasError("dateInFuture")),t.R7$(4),t.JRh(t.bMT(16,61,"Auditing.ToDate")),t.R7$(3),t.Y8G("displayType","datetime"),t.R7$(),t.Y8G("ngIf",s.filterForm.hasError("fromDateIsAfterToDate")),t.R7$(7),t.AVh("tw-btn-link",!s.checkQuickDate("today")),t.BMQ("aria-label",t.bMT(27,63,"Auditing.SetDateToday")),t.R7$(2),t.SpI(" ",t.bMT(29,65,"Auditing.Today")," "),t.R7$(3),t.AVh("tw-btn-link",!s.checkQuickDate("24hours")),t.BMQ("aria-label",t.bMT(32,67,"Auditing.SetDateLast24Hours")),t.R7$(2),t.SpI(" ",t.bMT(34,69,"Auditing.24Hours")," "),t.R7$(3),t.AVh("tw-btn-link",!s.checkQuickDate("yesterday")),t.BMQ("aria-label",t.bMT(37,71,"Auditing.SetDateYesterday")),t.R7$(2),t.SpI(" ",t.bMT(39,73,"Auditing.Yesterday")," "),t.R7$(3),t.AVh("tw-btn-link",!s.checkQuickDate("week")),t.BMQ("aria-label",t.bMT(42,75,"Auditing.SetDateLastWeek")),t.R7$(2),t.SpI(" ",t.bMT(44,77,"Auditing.Week")," "),t.R7$(4),t.Y8G("ngIf",s.resourceOnly),t.R7$(4),t.JRh(t.bMT(52,79,"Auditing.ResultsPerPage")),t.R7$(5),t.Y8G("value",25),t.R7$(2),t.Y8G("value",50),t.R7$(2),t.Y8G("value",100),t.R7$(3),t.Y8G("ngIf",s.showActiveFilters()),t.R7$(3),t.Y8G("ngIf",!s.showAddFilter),t.R7$(),t.Y8G("ngIf",s.showAddFilter),t.R7$(),t.Y8G("hidden",!s.showAddFilter),t.R7$(5),t.JRh(t.bMT(74,81,"Auditing.AddFilter")),t.R7$(8),t.JRh(t.bMT(82,83,"Auditing.Source")),t.R7$(2),t.Y8G("ngIf",!s.resourceBySubject),t.R7$(2),t.SpI("",t.bMT(86,85,"Auditing.Action")," "),t.R7$(2),t.Y8G("ngIf",!s.resourceByResource),t.R7$(2),t.BMQ("placeholder",t.bMT(91,87,"Auditing.FilterTermPlaceholder"))("aria-label",t.bMT(92,89,"Auditing.AddFilterTerm")),t.R7$(7),t.JRh(t.bMT(97,91,"Common.Add")),t.R7$(5),t.JRh(t.bMT(102,93,"Auditing.Showing")),t.R7$(4),t.AVh("tw-btn-link",!(!s.successfulFilter&&!s.unsuccessfulFilter)),t.R7$(),t.SpI(" ",t.bMT(107,95,"Permission.All")," "),t.R7$(3),t.AVh("tw-btn-link",!(s.successfulFilter&&!s.unsuccessfulFilter)),t.R7$(),t.SpI(" ",t.bMT(111,97,"Notifications.Success")," "),t.R7$(3),t.AVh("tw-btn-link",!(s.unsuccessfulFilter&&!s.successfulFilter)),t.R7$(),t.SpI(" ",t.bMT(115,99,"Notifications.Failure")," "),t.R7$(5),t.Y8G("disabled",(null==s.filterForm?null:s.filterForm.errors)||(null==(o=s.filterForm.get("fromDate"))?null:o.hasError("dateInFuture"))),t.R7$(),t.SpI(" ",t.bMT(121,101,"Auditing.ExecuteAndDisplay")," "),t.R7$(3),t.SpI(" ",t.bMT(124,103,"Auditing.Reset")," "),t.R7$(2),t.Y8G("ngIf",s.filterHasChanged),t.R7$(),t.Y8G("ngIf",!s.isLoading),t.R7$(),t.Y8G("ngIf",s.isLoading),t.R7$(),t.Y8G("ngIf",(null==s.pagedResult?null:s.pagedResult.results.length)<1&&!s.isLoading),t.R7$(),t.Y8G("ngIf",(null==s.pagedResult?null:s.pagedResult.results.length)>0&&!s.isLoading),t.R7$(),t.Y8G("ngIf",(null==s.pagedResult?null:s.pagedResult.results.length)>0&&!s.isLoading)}},dependencies:[I.Sq,I.bT,u.qT,u.xH,u.y7,u.wz,u.BC,u.cb,u.cV,u.j4,u.JD,u.$R,$.dg,y.B,D.n,C.d,E.Z,L.D9,G.r7],encapsulation:2})}}return i})()}}]);